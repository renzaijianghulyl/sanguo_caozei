# 手动同步指南（自动同步失败备用方案）

由于自动同步管道（SFTP/SCP）因网络或认证问题失败，本指南提供手动下载代码包并导入微信开发者工具的完整步骤。

## 前置条件
- 已安装微信开发者工具（最新稳定版）
- 本地 Mac 环境（目标目录：`/Users/liyulong/Desktop/caozei`）
- 终端访问权限（用于解压与文件操作）
- 服务端环境已准备（DeepSeek API 密钥配置完成）

## 步骤概览
1. **下载代码包**：获取 `game_code_latest.zip`
2. **解压到本地目录**：覆盖目标目录 `/Users/liyulong/Desktop/caozei`
3. **导入项目**：在微信开发者工具中打开解压后的文件夹
4. **配置服务端地址**：根据需要调整 `config.min.js` 中的 API 地址
5. **构建体验版**：生成二维码供测试体验

---

## 详细步骤

### 步骤1：下载代码包
从当前环境的 `outputs/` 目录下载最新代码包：
- 文件名：`game_code_latest.zip`
- 大小：约 9.1KB（包含完整构建产物）
- 内容：已压缩的 `dist/` 目录，包含：
  - `game.min.js` – 游戏主逻辑
  - `main.min.js` – 客户端入口
  - `config.min.js` – 客户端配置（API地址、默认状态）
  - `save.min.js` – 存档管理
  - `game.json` – 小游戏配置文件
  - `build_report.md` – 构建报告

### 步骤2：解压到本地目录
打开终端，执行以下命令（请确保目标目录存在，若不存在请先创建）：

```bash
# 创建目标目录（如不存在）
mkdir -p "/Users/liyulong/Desktop/caozei"

# 解压代码包（假设已下载到 Downloads 目录）
cd "/Users/liyulong/Desktop/caozei"
unzip -o ~/Downloads/game_code_latest.zip

# 验证解压结果
ls -la
```
预期输出应包含上述 6 个文件。

### 步骤3：导入微信开发者工具
1. 启动微信开发者工具
2. 点击「导入项目」
3. 选择目录：`/Users/liyulong/Desktop/caozei`
4. 填写 AppID（可使用测试号）
5. 项目类型选择「小游戏」
6. 点击「导入」

导入后，工具将自动识别 `game.json` 并加载项目结构。

### 步骤4：配置服务端地址
当前 `config.min.js` 中的 API 地址默认为：
```javascript
ADJUDICATION_API: process.env.ADJUDICATION_API || "http://localhost:3000/intent/resolve"
```
若服务端部署在其他地址（如远程服务器），请按以下方式修改：

**方式一：通过环境变量（推荐）**
在启动微信开发者工具前设置环境变量：
```bash
export ADJUDICATION_API="https://your-server.com/intent/resolve"
open /Applications/wechatwebdevtools.app
```

**方式二：直接修改配置文件**
编辑 `/Users/liyulong/Desktop/caozei/config.min.js`，将 `ADJUDICATION_API` 值改为你的服务端地址。

> **服务端部署提示**：若尚未部署服务端，请参考 `docs/environment-configuration.md` 完成 Node.js 服务端配置与启动。

### 步骤5：构建与体验版
1. 在微信开发者工具中点击「预览」
2. 选择「体验版」构建
3. 生成二维码
4. 使用微信扫码即可在真机上体验

首次构建可能需 1-2 分钟，请耐心等待。

---

## 验证与故障排除

### 验证代码包完整性
解压后可通过以下命令校验文件一致性：
```bash
cd "/Users/liyulong/Desktop/caozei"
md5sum config.min.js game.min.js main.min.js save.min.js game.json build_report.md
```
输出应与下表一致：

| 文件 | MD5 校验和（示例） |
|------|-------------------|
| config.min.js | `a1b2c3...` |
| game.min.js | `d4e5f6...` |
| main.min.js | `g7h8i9...` |
| save.min.js | `j0k1l2...` |
| game.json | `m3n4o5...` |
| build_report.md | `p6q7r8...` |

> 实际校验和请通过 `md5sum` 命令获取。

### 常见问题
1. **解压失败**：确保 zip 文件完整，可尝试重新下载
2. **导入后无代码**：检查目录是否为空，确保解压时使用了 `-o` 覆盖参数
3. **服务端连接超时**：确认服务端进程已启动（端口 3000），且防火墙允许访问
4. **体验版扫码后白屏**：检查开发者工具控制台错误，常见原因为 API 地址配置错误

### 回滚与版本管理
每次手动同步前，建议备份当前目录：
```bash
cp -r "/Users/liyulong/Desktop/caozei" "/Users/liyulong/Desktop/caozei_backup_$(date +%Y%m%d)"
```
若新版本出现问题，可快速恢复至备份版本。

---

## 后续步骤
手动同步完成后，即可进行：
- **灰度测试**：按 `docs/灰度测试指南.md` 分发体验版二维码
- **反馈收集**：使用内置问卷收集用户意见
- **迭代更新**：根据反馈调整代码，重新打包并重复本指南步骤

## 联系支持
若遇到无法解决的问题，请提供以下信息：
1. 微信开发者工具版本号
2. 终端执行命令与完整输出
3. 浏览器控制台错误截图
4. 服务端日志（如有）

> 本指南最后更新：2026-02-11