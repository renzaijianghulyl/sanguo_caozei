"use strict";var u=Object.defineProperty,$=Object.defineProperties,j=Object.getOwnPropertyDescriptor,W=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertyNames,E=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var x=(r,e,t)=>e in r?u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,s=(r,e)=>{for(var t in e||(e={}))R.call(e,t)&&x(r,t,e[t]);if(E)for(var t of E(e))J.call(e,t)&&x(r,t,e[t]);return r},h=(r,e)=>$(r,W(e));var V=(r,e)=>{for(var t in e)u(r,t,{get:e[t],enumerable:!0})},K=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Y(e))!R.call(r,i)&&i!==t&&u(r,i,{get:()=>e[i],enumerable:!(n=j(e,i))||n.enumerable});return r};var q=r=>K(u({},"__esModule",{value:!0}),r);var ye={};V(ye,{SAVE_VERSION:()=>f,STORAGE_KEY_PREFIX:()=>y,SaveManager:()=>g,SaveManagerConfig:()=>k,saveManager:()=>pe});module.exports=q(ye);function X(r){return{affinity:0,relation_type:"",memory_shards:[],last_seen_world_time:s({},r),last_interaction_year:r.year}}function Q(r,e){var n,i;if(!r)return;let t=r;Array.isArray(t.milestones)&&!Array.isArray(r.memory_shards)&&(r.memory_shards=[...t.milestones]),r.relation_type===void 0&&(r.relation_type=""),r.last_interaction_year===void 0&&(r.last_interaction_year=(i=(n=r.last_seen_world_time)==null?void 0:n.year)!=null?i:e.year)}function p(r,e){if(!r.bond){r.bond=X(e);return}Q(r.bond,e),b(r)}function S(r,e,t){var i,o;let n=s({},r.relations);if(e.father_id!=null&&e.father_id>0&&(n[String(e.father_id)]=85),e.spouse_id!=null&&e.spouse_id>0&&(n[String(e.spouse_id)]=90),(i=e.close_friends)!=null&&i.length)for(let a of e.close_friends)n[String(a)]=70;if((o=e.rivals)!=null&&o.length)for(let a of e.rivals)n[String(a)]=25;Object.keys(n).length>0&&(r.relations=n)}function b(r){r.bond&&(r.player_favor=Math.round(r.bond.affinity),r.player_relation=Z(r.bond.relation_type))}function Z(r){return r==="sworn_brother"?"sworn_brother":r==="spouse"?"spouse":r==="acquaintance"||r==="lord_vassal"||r==="admiration"?"acquaintance":""}var P=[{id:1001,name:"\u6D1B\u9633",type:"\u5927\u90FD\u5E02",adjacent_regions:["\u864E\u7262\u5173"],commerce:950,farming:800,culture:980,defense:900,money:2e6,food:1e6,population:95e4,troop_count:6e4,owner_faction_id:1,loyalty:75,landscape_description:"\u5E1D\u90FD\u6C14\u8C61\uFF0C\u5BAB\u9619\u5DCD\u5CE8\uFF0C\u5B98\u9053\u5BBD\u9614\uFF0C\u8F66\u9A6C\u7EDC\u7ECE\u3002",landmarks:["\u5357\u5BAB","\u5317\u5BAB","\u94DC\u9A7C\u8857","\u5F00\u9633\u95E8","\u6731\u96C0\u95E8","\u592A\u5B66"]},{id:1002,name:"\u90BA\u57CE",type:"\u4E00\u822C",adjacent_regions:["\u864E\u7262\u5173"],commerce:780,farming:850,culture:720,defense:800,money:12e5,food:15e5,population:8e5,troop_count:4e4,owner_faction_id:1,loyalty:70,landscape_description:"\u6F33\u6C34\u4E4B\u6EE8\uFF0C\u57CE\u90ED\u4E25\u6574\uFF0C\u5E02\u4E95\u7E41\u534E\uFF0C\u5546\u8D3E\u4E91\u96C6\u3002",landmarks:["\u94DC\u96C0\u53F0","\u91D1\u864E\u53F0","\u51B0\u4E95\u53F0","\u6587\u660C\u6BBF","\u90BA\u57CE\u5BAB","\u6F33\u6C34\u6865"]},{id:1003,name:"\u8BB8\u660C",type:"\u4E00\u822C",adjacent_regions:["\u6C5D\u5357","\u9648\u7559"],commerce:820,farming:880,culture:750,defense:780,money:11e5,food:14e5,population:75e4,troop_count:35e3,owner_faction_id:1,loyalty:72,landscape_description:"\u4E2D\u539F\u8179\u5730\uFF0C\u7530\u91CE\u5E73\u65F7\uFF0C\u57CE\u6C60\u575A\u56FA\uFF0C\u5C6F\u7530\u5174\u76DB\u3002",landmarks:["\u8BB8\u660C\u5BAB","\u6BD3\u79C0\u53F0","\u6625\u79CB\u697C","\u705E\u9675\u6865","\u66F9\u64CD\u5E9C\u90B8"]},{id:1004,name:"\u9648\u7559",type:"\u4E00\u822C",adjacent_regions:["\u6FEE\u9633","\u864E\u7262\u5173","\u8BB8\u660C"],commerce:750,farming:800,culture:700,defense:750,money:9e5,food:11e5,population:7e5,troop_count:3e4,owner_faction_id:1,loyalty:68,landscape_description:"\u5156\u5DDE\u901A\u8862\uFF0C\u9A7F\u9053\u7EB5\u6A2A\uFF0C\u5546\u65C5\u5F80\u6765\uFF0C\u5175\u5BB6\u5FC5\u4E89\u3002",landmarks:["\u9648\u7559\u57CE\u95E8","\u53E4\u9A7F\u9053","\u5F20\u9088\u5E9C","\u5178\u97E6\u7960"]},{id:1005,name:"\u6FEE\u9633",type:"\u4E00\u822C",adjacent_regions:["\u9648\u7559"],commerce:720,farming:780,culture:680,defense:740,money:85e4,food:1e6,population:65e4,troop_count:28e3,owner_faction_id:1,loyalty:65,landscape_description:"\u9EC4\u6CB3\u4E4B\u7554\uFF0C\u6C34\u9646\u4EA4\u6C47\uFF0C\u57CE\u57A3\u9AD8\u8038\uFF0C\u5175\u71F9\u9891\u4ECD\u3002",landmarks:["\u6FEE\u9633\u57CE\u697C","\u9EC4\u6CB3\u6E21\u53E3","\u5415\u5E03\u5C6F\u5175\u5904","\u66F9\u64CD\u7960"]},{id:1006,name:"\u8C2F\u53BF",type:"\u4E00\u822C",adjacent_regions:["\u5C0F\u6C9B","\u6C5D\u5357"],commerce:650,farming:750,culture:600,defense:650,money:7e5,food:9e5,population:6e5,troop_count:25e3,owner_faction_id:1,loyalty:70,landscape_description:"\u6DEE\u5317\u5E73\u539F\uFF0C\u6C11\u98CE\u5F6A\u608D\uFF0C\u66F9\u6C0F\u6545\u91CC\uFF0C\u8C6A\u6770\u8F88\u51FA\u3002",landmarks:["\u66F9\u6C0F\u5B97\u7960","\u8C2F\u53BF\u57CE\u95E8","\u53E4\u4E95","\u590F\u4FAF\u6C0F\u5B85"]},{id:1007,name:"\u4E0B\u90B3",type:"\u4E00\u822C",adjacent_regions:["\u5C0F\u6C9B"],commerce:780,farming:820,culture:700,defense:760,money:95e4,food:12e5,population:72e4,troop_count:32e3,owner_faction_id:1,loyalty:67,landscape_description:"\u6CD7\u6C34\u73AF\u7ED5\uFF0C\u57CE\u6C60\u9669\u56FA\uFF0C\u5357\u5317\u54BD\u5589\uFF0C\u6218\u4E8B\u4E0D\u65AD\u3002",landmarks:["\u4E0B\u90B3\u57CE\u5899","\u6CD7\u6C34\u6865","\u767D\u95E8\u697C","\u5415\u5E03\u88AB\u56F0\u5904"]},{id:1008,name:"\u5C0F\u6C9B",type:"\u4E00\u822C",adjacent_regions:["\u4E0B\u90B3","\u8C2F\u53BF"],commerce:600,farming:700,culture:550,defense:620,money:6e5,food:8e5,population:55e4,troop_count:22e3,owner_faction_id:1,loyalty:63,landscape_description:"\u6C9B\u56FD\u5C0F\u57CE\uFF0C\u7530\u91CE\u8352\u829C\uFF0C\u5175\u7CAE\u532E\u4E4F\uFF0C\u5C61\u906D\u653B\u4F10\u3002",landmarks:["\u5C0F\u6C9B\u57CE\u95E8","\u5218\u5907\u5C6F\u5175\u5904","\u53E4\u9A7F\u4EAD"]},{id:1009,name:"\u6C5D\u5357",type:"\u4E00\u822C",adjacent_regions:["\u5B9B\u57CE","\u65B0\u91CE","\u8BB8\u660C","\u8C2F\u53BF"],commerce:680,farming:770,culture:620,defense:670,money:75e4,food:95e4,population:63e4,troop_count:27e3,owner_faction_id:1,loyalty:66,landscape_description:"\u6C5D\u6C34\u4E4B\u5357\uFF0C\u6C83\u91CE\u5343\u91CC\uFF0C\u57CE\u9091\u6797\u7ACB\uFF0C\u9EC4\u5DFE\u4F59\u90E8\u3002",landmarks:["\u6C5D\u5357\u57CE\u95E8","\u6C5D\u6C34\u6E21\u53E3","\u9EC4\u5DFE\u8425\u5BE8","\u8881\u6C0F\u6545\u5B85"]},{id:1010,name:"\u5B9B\u57CE",type:"\u4E00\u822C",adjacent_regions:["\u65B0\u91CE","\u6C5D\u5357"],commerce:700,farming:760,culture:650,defense:690,money:8e5,food:1e6,population:65e4,troop_count:29e3,owner_faction_id:1,loyalty:64,landscape_description:"\u6DEF\u6C34\u4E4B\u6EE8\uFF0C\u57CE\u9AD8\u6C60\u6DF1\uFF0C\u5546\u8D38\u7E41\u76DB\uFF0C\u5F20\u7EE3\u636E\u5B88\u3002",landmarks:["\u5B9B\u57CE\u57CE\u5899","\u6DEF\u6C34\u7801\u5934","\u5F20\u7EE3\u5E9C\u90B8","\u66F9\u64CD\u8D25\u8D70\u5904"]},{id:1011,name:"\u8944\u9633",type:"\u4E00\u822C",adjacent_regions:["\u65B0\u91CE"],commerce:760,farming:790,culture:730,defense:780,money:92e4,food:11e5,population:71e4,troop_count:33e3,owner_faction_id:1,loyalty:69,landscape_description:"\u6C49\u6C34\u4E4B\u7554\uFF0C\u5C71\u5DDD\u5F62\u80DC\uFF0C\u57CE\u6C60\u96C4\u9614\uFF0C\u6C34\u9646\u8981\u51B2\u3002",landmarks:["\u8944\u9633\u57CE\u5899","\u6C49\u6C34\u7801\u5934","\u9E7F\u95E8\u5C71","\u8BF8\u845B\u4EAE\u6545\u5C45"]},{id:1012,name:"\u65B0\u91CE",type:"\u4E00\u822C",adjacent_regions:["\u5B9B\u57CE","\u6C5D\u5357","\u8944\u9633"],commerce:350,farming:450,culture:300,defense:400,money:3e5,food:5e5,population:35e4,troop_count:15e3,owner_faction_id:1,loyalty:60,landscape_description:"\u5357\u9633\u76C6\u5730\uFF0C\u5C0F\u53BF\u50FB\u58E4\uFF0C\u7530\u91CE\u8427\u758F\uFF0C\u5218\u5907\u5C6F\u5175\u3002",landmarks:["\u65B0\u91CE\u57CE\u95E8","\u5218\u5907\u5B85\u90B8","\u53E4\u9A7F\u9053"]},{id:1013,name:"\u4E0A\u515A",type:"\u4E00\u822C",adjacent_regions:["\u664B\u9633"],commerce:550,farming:600,culture:500,defense:700,money:5e5,food:7e5,population:5e5,troop_count:2e4,owner_faction_id:1,loyalty:62,landscape_description:"\u592A\u884C\u9669\u5730\uFF0C\u5C71\u9053\u5D0E\u5C96\uFF0C\u5173\u9698\u91CD\u91CD\uFF0C\u6613\u5B88\u96BE\u653B\u3002",landmarks:["\u58F6\u5173","\u4E0A\u515A\u57CE\u95E8","\u592A\u884C\u53E4\u9053","\u5F20\u6768\u636E\u5B88\u5904"]},{id:1014,name:"\u664B\u9633",type:"\u4E00\u822C",adjacent_regions:["\u4E0A\u515A","\u84DF\u53BF"],commerce:580,farming:620,culture:520,defense:720,money:55e4,food:75e4,population:52e4,troop_count:21e3,owner_faction_id:1,loyalty:61,landscape_description:"\u6C7E\u6C34\u4E4B\u9633\uFF0C\u57CE\u57A3\u575A\u56FA\uFF0C\u80E1\u6C49\u6742\u5C45\uFF0C\u8FB9\u585E\u91CD\u9547\u3002",landmarks:["\u664B\u9633\u57CE\u95E8","\u6C7E\u6C34\u6E21\u53E3","\u5E76\u5DDE\u523A\u53F2\u5E9C","\u5308\u5974\u738B\u5EAD"]},{id:1015,name:"\u84DF\u53BF",type:"\u4E00\u822C",adjacent_regions:["\u664B\u9633"],commerce:620,farming:670,culture:580,defense:680,money:65e4,food:85e4,population:58e4,troop_count:24e3,owner_faction_id:1,loyalty:63,landscape_description:"\u71D5\u5C71\u811A\u4E0B\uFF0C\u8FB9\u5173\u9501\u94A5\uFF0C\u57CE\u90ED\u4FE8\u7136\uFF0C\u4E4C\u6853\u9891\u6270\u3002",landmarks:["\u84DF\u53BF\u57CE\u95E8","\u71D5\u5C71\u5173\u9698","\u5E7D\u5DDE\u523A\u53F2\u5E9C","\u516C\u5B59\u74D2\u9A7B\u519B\u5904"]},{id:1016,name:"\u864E\u7262\u5173",type:"\u5173\u9698",adjacent_regions:["\u6D1B\u9633","\u9648\u7559","\u90BA\u57CE"],commerce:200,farming:150,culture:180,defense:980,money:2e5,food:3e5,population:1e5,troop_count:15e3,owner_faction_id:1,loyalty:80,landscape_description:"\u96C4\u5173\u9669\u8981\uFF0C\u5CED\u58C1\u4E34\u6CB3\uFF0C\u4E00\u592B\u5F53\u5173\uFF0C\u4E07\u592B\u83AB\u5F00\u3002",landmarks:["\u864E\u7262\u5173\u57CE","\u6C5C\u6C34","\u5415\u5E03\u8425\u5BE8","\u4E09\u82F1\u6218\u5415\u5E03\u5904"]}];var te=P,L=new Map;te.forEach(r=>L.set(r.id,r));function B(r){var t;let e=L.get(r);return(t=e==null?void 0:e.name)!=null?t:String(r)}var O=[{id:2001,name:"\u5F20\u89D2",birth_year:140,death_year:184,appear_year:170,str:62,int:85,pol:78,lea:70,personality_traits:["\u91CE\u5FC3\u52C3\u52C3","\u5584\u4E8E\u86CA\u60D1","\u7406\u60F3\u4E3B\u4E49"],speech_style:"\u9053\u6559\u672F\u8BED\u6DF7\u6742\uFF0C\u5E26\u6709\u795E\u79D8\u8272\u5F69",father_id:null,spouse_id:null,close_friends:[2002,2003],rivals:[2009,2010],current_region_id:1001,owner_faction_id:2},{id:2002,name:"\u5F20\u5B9D",birth_year:145,death_year:184,appear_year:172,str:68,int:72,pol:60,lea:65,personality_traits:["\u52C7\u731B","\u6025\u8E81","\u5FE0\u8BDA"],speech_style:"\u76F4\u7387\u7C97\u72B7\uFF0C\u7565\u5E26\u8349\u83BD\u6C14\u606F",father_id:null,spouse_id:null,close_friends:[2001,2003],rivals:[],current_region_id:1002,owner_faction_id:2},{id:2003,name:"\u5F20\u6881",birth_year:147,death_year:184,appear_year:174,str:70,int:65,pol:55,lea:68,personality_traits:["\u597D\u6597","\u8BB2\u4E49\u6C14","\u7F3A\u4E4F\u8C0B\u7565"],speech_style:"\u8A00\u8BED\u7C97\u4FD7\uFF0C\u597D\u6218\u8A00\u8F9E",father_id:null,spouse_id:null,close_friends:[2001,2002],rivals:[],current_region_id:1003,owner_faction_id:2},{id:2004,name:"\u6CE2\u624D",birth_year:155,death_year:184,appear_year:180,str:75,int:60,pol:50,lea:72,personality_traits:["\u9A81\u52C7","\u5584\u6218","\u7F3A\u4E4F\u8FDC\u89C1"],speech_style:"\u7B80\u6D01\u76F4\u63A5\uFF0C\u519B\u4E8B\u5316\u8BED\u8A00",father_id:null,spouse_id:null,close_friends:[],rivals:[2009],current_region_id:1004,owner_faction_id:2},{id:2005,name:"\u5F20\u66FC\u6210",birth_year:152,death_year:184,appear_year:178,str:72,int:58,pol:52,lea:65,personality_traits:["\u6B8B\u5FCD","\u8D2A\u5A6A","\u5584\u7B3C\u7EDC"],speech_style:"\u5A01\u5413\u5F0F\u8BED\u8A00\uFF0C\u5F3A\u8C03\u529B\u91CF",father_id:null,spouse_id:null,close_friends:[],rivals:[2010],current_region_id:1009,owner_faction_id:2},{id:2006,name:"\u7687\u752B\u5D69",birth_year:110,death_year:195,appear_year:160,str:80,int:85,pol:70,lea:88,personality_traits:["\u5FE0\u4E49","\u4E25\u8C28","\u5584\u7528\u5175"],speech_style:"\u6C89\u7A33\u6709\u529B\uFF0C\u5E26\u5112\u5BB6\u98CE\u8303",father_id:null,spouse_id:null,close_friends:[2010,2011],rivals:[2001,2004],current_region_id:1001,owner_faction_id:1},{id:2007,name:"\u6731\u5101",birth_year:105,death_year:195,appear_year:158,str:78,int:80,pol:75,lea:85,personality_traits:["\u521A\u76F4","\u679C\u6562","\u91CD\u519B\u7EAA"],speech_style:"\u7B80\u6D01\u6709\u529B\uFF0C\u519B\u4EBA\u6C14\u8D28",father_id:null,spouse_id:null,close_friends:[2009,2011],rivals:[2005],current_region_id:1001,owner_faction_id:1},{id:2008,name:"\u5362\u690D",birth_year:108,death_year:192,appear_year:162,str:65,int:90,pol:85,lea:75,personality_traits:["\u535A\u5B66","\u6B63\u76F4","\u4E0D\u5584\u53D8\u901A"],speech_style:"\u5F15\u7ECF\u636E\u5178\uFF0C\u5B66\u8005\u98CE\u8303",father_id:null,spouse_id:null,close_friends:[2009,2010],rivals:[],current_region_id:1001,owner_faction_id:1},{id:2009,name:"\u4F55\u8FDB",birth_year:135,death_year:189,appear_year:170,str:60,int:55,pol:50,lea:58,personality_traits:["\u5916\u621A\u6743\u8D35","\u4F18\u67D4\u5BE1\u65AD","\u597D\u6392\u573A"],speech_style:"\u5B98\u8154\u6D53\u539A\uFF0C\u7F3A\u4E4F\u6DF1\u5EA6",father_id:null,spouse_id:null,close_friends:[],rivals:[2026],current_region_id:1001,owner_faction_id:1},{id:2010,name:"\u66F9\u64CD",birth_year:155,death_year:220,appear_year:174,str:72,int:92,pol:88,lea:95,personality_traits:["\u591A\u7591","\u679C\u65AD","\u96C4\u624D\u5927\u7565"],speech_style:"\u673A\u654F\u7280\u5229\uFF0C\u5145\u6EE1\u6743\u8C0B\u8272\u5F69",father_id:null,spouse_id:null,close_friends:[2016,2017],rivals:[2021,2022],current_region_id:1006,owner_faction_id:1},{id:2011,name:"\u590F\u4FAF\u60C7",birth_year:157,death_year:220,appear_year:176,str:90,int:62,pol:58,lea:82,personality_traits:["\u521A\u70C8","\u5FE0\u52C7","\u8D28\u6734"],speech_style:"\u76F4\u6765\u76F4\u53BB\uFF0C\u91CD\u60C5\u91CD\u4E49",father_id:null,spouse_id:null,close_friends:[2015,2017],rivals:[],current_region_id:1006,owner_faction_id:1},{id:2012,name:"\u590F\u4FAF\u6E0A",birth_year:159,death_year:219,appear_year:178,str:88,int:65,pol:55,lea:85,personality_traits:["\u75BE\u901F","\u52C7\u731B","\u64C5\u5947\u88AD"],speech_style:"\u7B80\u6D01\u660E\u5FEB\uFF0C\u884C\u52A8\u6D3E\u8BED\u8A00",father_id:null,spouse_id:null,close_friends:[2015,2016],rivals:[],current_region_id:1006,owner_faction_id:1},{id:2013,name:"\u66F9\u4EC1",birth_year:158,death_year:223,appear_year:177,str:85,int:70,pol:65,lea:87,personality_traits:["\u7A33\u91CD","\u5584\u5B88","\u987E\u5168\u5927\u5C40"],speech_style:"\u52A1\u5B9E\u4E25\u8C28\uFF0C\u6CE8\u91CD\u7EC6\u8282",father_id:null,spouse_id:null,close_friends:[2015,2018],rivals:[],current_region_id:1006,owner_faction_id:1},{id:2014,name:"\u66F9\u6D2A",birth_year:160,death_year:232,appear_year:179,str:82,int:60,pol:50,lea:75,personality_traits:["\u6177\u6168","\u5FE0\u4E49","\u597D\u8D22\u8D27"],speech_style:"\u8C6A\u723D\u76F4\u63A5\uFF0C\u7565\u5E26\u5E02\u4E95\u6C14",father_id:null,spouse_id:null,close_friends:[2015,2017],rivals:[],current_region_id:1006,owner_faction_id:1},{id:2015,name:"\u5B59\u575A",birth_year:155,death_year:191,appear_year:172,str:92,int:70,pol:65,lea:88,personality_traits:["\u52C7\u70C8","\u679C\u6562","\u8F7B\u654C"],speech_style:"\u8C6A\u8FC8\u6FC0\u6602\uFF0C\u5145\u6EE1\u82F1\u96C4\u6C14\u6982",father_id:null,spouse_id:null,close_friends:[2024,2025],rivals:[2005],current_region_id:1011,owner_faction_id:1},{id:2016,name:"\u7A0B\u666E",birth_year:150,death_year:215,appear_year:168,str:85,int:72,pol:68,lea:82,personality_traits:["\u8001\u6210\u6301\u91CD","\u987E\u5168\u5927\u5C40","\u5FE0\u5FC3"],speech_style:"\u6C89\u7A33\u6709\u5EA6\uFF0C\u7ECF\u9A8C\u4E30\u5BCC",father_id:null,spouse_id:null,close_friends:[2020,2025],rivals:[],current_region_id:1011,owner_faction_id:1},{id:2017,name:"\u9EC4\u76D6",birth_year:145,death_year:215,appear_year:165,str:87,int:68,pol:60,lea:80,personality_traits:["\u521A\u6BC5","\u5FE0\u52C7","\u5584\u7528\u706B\u653B"],speech_style:"\u76F4\u7387\u5766\u8BDA\uFF0C\u7565\u5E26\u706B\u7206",father_id:null,spouse_id:null,close_friends:[2020,2024],rivals:[],current_region_id:1011,owner_faction_id:1},{id:2018,name:"\u97E9\u5F53",birth_year:152,death_year:225,appear_year:175,str:83,int:60,pol:55,lea:78,personality_traits:["\u9A81\u52C7","\u5584\u9A91\u5C04","\u4F4E\u8C03"],speech_style:"\u7B80\u6D01\u52A1\u5B9E\uFF0C\u4E0D\u559C\u5938\u9970",father_id:null,spouse_id:null,close_friends:[2020],rivals:[],current_region_id:1011,owner_faction_id:1},{id:2019,name:"\u5218\u5907",birth_year:161,death_year:223,appear_year:180,str:75,int:80,pol:85,lea:82,personality_traits:["\u4EC1\u5FB7","\u575A\u97E7","\u5584\u4E8E\u7528\u4EBA"],speech_style:"\u6E29\u539A\u8BDA\u6073\uFF0C\u5E26\u6709\u7406\u60F3\u8272\u5F69",father_id:null,spouse_id:null,close_friends:[2026,2027],rivals:[],current_region_id:1015,owner_faction_id:1},{id:2020,name:"\u5173\u7FBD",birth_year:160,death_year:220,appear_year:179,str:97,int:75,pol:62,lea:90,personality_traits:["\u5FE0\u4E49","\u9A84\u50B2","\u91CD\u8BFA"],speech_style:"\u5E84\u91CD\u5A01\u4E25\uFF0C\u7565\u5E26\u50B2\u6C14",father_id:null,spouse_id:null,close_friends:[2025,2027],rivals:[],current_region_id:1015,owner_faction_id:1},{id:2021,name:"\u5F20\u98DE",birth_year:166,death_year:221,appear_year:183,str:98,int:40,pol:30,lea:85,personality_traits:["\u52C7\u731B","\u66B4\u8E81","\u656C\u91CD\u58EB\u4EBA"],speech_style:"\u7C97\u58F0\u5927\u6C14\uFF0C\u76F4\u6765\u76F4\u53BB",father_id:null,spouse_id:null,close_friends:[2025,2026],rivals:[],current_region_id:1015,owner_faction_id:1},{id:2022,name:"\u8881\u7ECD",birth_year:154,death_year:202,appear_year:172,str:70,int:75,pol:78,lea:82,personality_traits:["\u4F18\u67D4\u5BE1\u65AD","\u597D\u9762\u5B50","\u56DB\u4E16\u4E09\u516C"],speech_style:"\u6587\u96C5\u4F46\u7F3A\u4E4F\u51B3\u65AD\uFF0C\u91CD\u95E8\u7B2C",father_id:null,spouse_id:null,close_friends:[],rivals:[2015,2022],current_region_id:1002,owner_faction_id:4},{id:2023,name:"\u8881\u672F",birth_year:156,death_year:199,appear_year:174,str:65,int:60,pol:55,lea:68,personality_traits:["\u72C2\u5984","\u5962\u4F88","\u76EE\u5149\u77ED\u6D45"],speech_style:"\u50B2\u6162\u81EA\u5927\uFF0C\u597D\u70AB\u8000\u51FA\u8EAB",father_id:null,spouse_id:null,close_friends:[],rivals:[2021,2015],current_region_id:1007,owner_faction_id:1},{id:2024,name:"\u5218\u8868",birth_year:142,death_year:208,appear_year:165,str:60,int:80,pol:85,lea:70,personality_traits:["\u5B88\u6210","\u591A\u7591","\u5584\u4E8E\u6CBB\u7406"],speech_style:"\u6587\u58EB\u98CE\u8303\uFF0C\u8C28\u614E\u4FDD\u5B88",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1011,owner_faction_id:1},{id:2025,name:"\u516C\u5B59\u74D2",birth_year:150,death_year:199,appear_year:170,str:85,int:65,pol:60,lea:82,personality_traits:["\u521A\u731B","\u5584\u9A91\u5C04","\u6392\u5916"],speech_style:"\u5E72\u8106\u5229\u843D\uFF0C\u519B\u4EBA\u6C14\u8D28",father_id:null,spouse_id:null,close_friends:[2025],rivals:[2021],current_region_id:1015,owner_faction_id:1},{id:2026,name:"\u8463\u5353",birth_year:138,death_year:192,appear_year:160,str:88,int:50,pol:40,lea:85,personality_traits:["\u6B8B\u66B4","\u8D2A\u5A6A","\u4E13\u6743"],speech_style:"\u86EE\u6A2A\u9738\u9053\uFF0C\u5A01\u80C1\u6027\u8BED\u8A00",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1014,owner_faction_id:3},{id:2027,name:"\u5415\u5E03",birth_year:156,death_year:199,appear_year:176,str:100,int:30,pol:20,lea:90,personality_traits:["\u52C7\u51A0\u4E09\u519B","\u53CD\u590D\u65E0\u5E38","\u597D\u8272"],speech_style:"\u56A3\u5F20\u8DCB\u6248\uFF0C\u76EE\u4E2D\u65E0\u4EBA",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1014,owner_faction_id:3},{id:2028,name:"\u8C82\u8749",birth_year:168,death_year:"\u672A\u77E5",appear_year:184,str:15,int:85,pol:70,lea:40,personality_traits:["\u7F8E\u8C8C","\u673A\u667A","\u5FE0\u4E49"],speech_style:"\u6E29\u67D4\u5A49\u7EA6\uFF0C\u5584\u4E8E\u5468\u65CB",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1001,owner_faction_id:1},{id:2029,name:"\u8340\u5F67",birth_year:163,death_year:212,appear_year:180,str:30,int:95,pol:92,lea:70,personality_traits:["\u738B\u4F50\u4E4B\u624D","\u5FE0\u8BDA","\u575A\u6301\u539F\u5219"],speech_style:"\u6E29\u6587\u5C14\u96C5\uFF0C\u903B\u8F91\u4E25\u5BC6",father_id:null,spouse_id:null,close_friends:[2015],rivals:[],current_region_id:1006,owner_faction_id:1},{id:2030,name:"\u90ED\u5609",birth_year:170,death_year:207,appear_year:184,str:25,int:98,pol:60,lea:75,personality_traits:["\u5947\u8C0B","\u4E0D\u62D8\u5C0F\u8282","\u65E9\u901D"],speech_style:"\u7280\u5229\u76F4\u63A5\uFF0C\u4E0D\u62D8\u793C\u6CD5",father_id:null,spouse_id:null,close_friends:[2015],rivals:[],current_region_id:1006,owner_faction_id:1},{id:2031,name:"\u5468\u745C",birth_year:175,death_year:210,appear_year:184,str:75,int:96,pol:80,lea:92,personality_traits:["\u98CE\u6D41\u501C\u50A5","\u667A\u8C0B\u8D85\u7FA4","\u6C14\u91CF\u72ED\u5C0F"],speech_style:"\u6587\u96C5\u4E2D\u5E26\u950B\u8292\uFF0C\u81EA\u4FE1\u4ECE\u5BB9",father_id:null,spouse_id:null,close_friends:[2020],rivals:[],current_region_id:1011,owner_faction_id:1},{id:2032,name:"\u8BF8\u845B\u4EAE",birth_year:181,death_year:234,appear_year:184,str:40,int:100,pol:95,lea:92,personality_traits:["\u97A0\u8EAC\u5C3D\u7601","\u8C28\u614E","\u591A\u8C0B"],speech_style:"\u6DF1\u601D\u719F\u8651\uFF0C\u5F15\u7ECF\u636E\u5178",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1012,owner_faction_id:1},{id:2033,name:"\u9A6C\u5143\u4E49",birth_year:148,death_year:184,appear_year:176,str:68,int:65,pol:60,lea:70,personality_traits:["\u7EC4\u7EC7\u80FD\u529B\u5F3A","\u5FE0\u8BDA"],speech_style:"\u6C89\u7A33\u6709\u5E8F\uFF0C\u5584\u4E8E\u52A8\u5458",father_id:null,spouse_id:null,close_friends:[2001],rivals:[],current_region_id:1001,owner_faction_id:2},{id:2034,name:"\u8D75\u5F18",birth_year:153,death_year:184,appear_year:178,str:72,int:58,pol:50,lea:65,personality_traits:["\u52C7\u731B","\u9C81\u83BD"],speech_style:"\u7C97\u72B7\u8C6A\u653E\uFF0C\u597D\u6218",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1009,owner_faction_id:2},{id:2035,name:"\u4E01\u539F",birth_year:140,death_year:189,appear_year:165,str:75,int:65,pol:60,lea:78,personality_traits:["\u5FE0\u76F4","\u4E0D\u5584\u6743\u8C0B"],speech_style:"\u6734\u5B9E\u521A\u76F4\uFF0C\u519B\u4EBA\u4F5C\u98CE",father_id:null,spouse_id:null,close_friends:[],rivals:[2030],current_region_id:1014,owner_faction_id:1},{id:2036,name:"\u5F20\u8BA9",birth_year:135,death_year:189,appear_year:160,str:30,int:80,pol:70,lea:40,personality_traits:["\u5978\u8BC8","\u963F\u8C00","\u4E13\u6743"],speech_style:"\u9634\u9633\u602A\u6C14\uFF0C\u6311\u62E8\u79BB\u95F4",father_id:null,spouse_id:null,close_friends:[],rivals:[2013],current_region_id:1001,owner_faction_id:1},{id:2037,name:"\u5B54\u878D",birth_year:153,death_year:208,appear_year:170,str:40,int:85,pol:80,lea:60,personality_traits:["\u6587\u4EBA\u50B2\u9AA8","\u76F4\u8A00\u6562\u8C0F","\u4E0D\u5584\u5175\u4E8B"],speech_style:"\u5F15\u7ECF\u636E\u5178\uFF0C\u597D\u8FA9",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1008,owner_faction_id:1},{id:2038,name:"\u9676\u8C26",birth_year:132,death_year:194,appear_year:158,str:60,int:75,pol:78,lea:70,personality_traits:["\u4EC1\u539A","\u4FDD\u5B88","\u5E74\u8001"],speech_style:"\u6E29\u548C\u7F13\u6162\uFF0C\u957F\u8005\u98CE\u8303",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1007,owner_faction_id:1},{id:2039,name:"\u535C\u5DF1",birth_year:151,death_year:184,appear_year:177,str:70,int:55,pol:50,lea:68,personality_traits:["\u52C7\u731B","\u8FF7\u4FE1"],speech_style:"\u795E\u795E\u53E8\u53E8\uFF0C\u5F3A\u8C03\u5929\u610F",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1004,owner_faction_id:2},{id:2040,name:"\u5085\u71EE",birth_year:140,death_year:187,appear_year:165,str:75,int:78,pol:72,lea:80,personality_traits:["\u5FE0\u70C8","\u521A\u76F4"],speech_style:"\u6B63\u6C14\u51DB\u7136\uFF0C\u4E0D\u754F\u6743\u8D35",father_id:null,spouse_id:null,close_friends:[],rivals:[],current_region_id:1001,owner_faction_id:1}];var C=O;function M(r){return{id:String(r.id),name:r.name,birth_year:r.birth_year,death_year:r.death_year,stance:"neutral",trust:30,player_favor:0,player_relation:"",location:B(r.current_region_id)}}function G(r){return r>=184&&r<190,C}var H={version:"1.0",comment:"\u4E3B\u89D2\u4E0E\u6240\u6709\u4EBA\u521D\u59CB\u5747\u4E3A 0 \u4EB2\u5BC6\u5EA6\u3001\u65E0\u5173\u7CFB\u3002\u4EC5\u5217\u51FA\u9700\u8981\u975E\u96F6\u521D\u59CB\u503C\u7684 NPC\u3002encounter_threshold\uFF1A\u73A9\u5BB6\u6076\u540D\u2265\u8BE5\u503C\u65F6\u62D2\u7EDD\u4F1A\u9762\uFF0C\u89E6\u53D1\u95ED\u95E8\u8C22\u5BA2\u6216\u5B98\u5175\u56F4\u527F\u3002",byNpcId:{"2006":{encounter_threshold:30},"2010":{encounter_threshold:35},"2029":{encounter_threshold:25}}};var ie=H;function F(){var r;return(r=ie.byNpcId)!=null?r:{}}function z(r){return r==="sworn_brother"?"sworn_brother":r==="spouse"?"spouse":r==="acquaintance"?"acquaintance":""}var oe=30;function ae(r,e){let t=r.map(i=>M(i)),n=F();return t.forEach((i,o)=>{S(i,r[o],t),p(i,e);let a=n[i.id];a&&i.bond&&(typeof a.affinity=="number"&&(i.bond.affinity=Math.max(0,Math.min(100,a.affinity))),a.player_relation!=null&&a.player_relation!==""&&(i.bond.relation_type=z(a.player_relation)),Array.isArray(a.milestones)&&a.milestones.length>0&&(i.bond.memory_shards=a.milestones.slice(0,oe)),b(i))}),t}function se(r){let e=G(r);return ae(e,{year:r,month:1})}var D=se;var T={id:"player_001",birth_year:169,attrs:{strength:75,intelligence:82,charm:68,luck:55},legend:30,tags:["civilian"],reputation:50,resources:{gold:0,food:0,soldiers:0},location:{region:"yingchuan",scene:"village"},stamina:80,active_titles:[]},v={era:"184",flags:["taipingdao_spread=high"],history_flags:[],time:{year:184,month:2,day:1},regionStatus:{jingzhou:"stable",yuzhou:"turmoil",jizhou:"stable"}};var d=50;var le=["\u4E3B\u516C\uFF0C\u4F60\u6B63\u7F6E\u8EAB\u4E8E\u4E00\u4E2A\u771F\u5B9E\u7684 184 \u5E74\u3002\u5728\u8FD9\u91CC\uFF0C\u4F60\u7684\u6BCF\u4E00\u53E5\u8BDD\u90FD\u5C06\u88AB\u5E95\u5C42\u903B\u8F91\u5BA1\u89C6\u3002","\u4F60\u53EF\u4EE5\u901A\u8FC7\u6587\u5B57\u4E0E\u7FA4\u96C4\u535A\u5F08\uFF0C\u4E5F\u53EF\u4EE5\u9009\u62E9\u95ED\u5173\u4FEE\u70BC\u611F\u609F\u5929\u65F6\u3002\u5207\u8BB0\uFF0C\u65F6\u95F4\u6D41\u901D\u4F1A\u5E26\u6765\u4E16\u754C\u7684\u5267\u53D8\uFF0C\u8BF7\u614E\u91CD\u4F60\u7684\u6BCF\u4E00\u4E2A\u51B3\u7B56\u3002"],I=[],ke=[...le,...I];var w=D(184),c=(()=>{try{let e=(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{}).process;return e&&typeof e=="object"&&e!==null&&"env"in e?e.env||{}:{}}catch(r){return{}}})(),k={CLOUD_ENV:c.CLOUD_ENV||"cloud1-3gfb9ep2701c4857",ADJUDICATION_API:c.ADJUDICATION_API||"http://localhost:3000/intent/resolve",MAX_RETRIES:2,RETRY_DELAY:1e3,REQUEST_TIMEOUT:15e3,DEBUG:c.NODE_ENV!=="production",DEBUG_TOUCH:c.DEBUG_TOUCH==="true",AD_UNIT_ID:c.AD_UNIT_ID||"adunit-1234567890abcdef",DEFAULT_PLAYER_STATE:T,DEFAULT_WORLD_STATE:v,DEFAULT_NPC_STATE:w};var f="1.0.0";function U(r){var i,o;let e=r.world,t=e==null?void 0:e.time,n=t?{year:t.year,month:(i=t.month)!=null?i:1}:{year:184,month:1};return e&&e.history_flags===void 0&&(e.history_flags=[]),r.player&&r.player.active_titles===void 0&&(r.player.active_titles=[]),r.history_logs===void 0&&(r.history_logs=[]),(o=r.npcs)!=null&&o.length&&r.npcs.forEach(a=>p(a,n)),r}function _e(r){return r.map(e=>e.replace(/建[安宁]元年\s*（\s*公元\s*168\s*年\s*）/g,"\u4E2D\u5E73\u5143\u5E74\uFF08\u516C\u5143184\u5E74\uFF09").replace(/公元\s*168\s*年/g,"\u516C\u5143184\u5E74").replace(/168\s*年/g,"184\u5E74"))}function ce(){if(typeof wx!="undefined"&&typeof wx.setStorageSync=="function")return{setItem(e,t){wx.setStorageSync(e,t)},getItem(e){let t=wx.getStorageSync(e);return t===""?void 0:t},removeItem(e){wx.removeStorageSync(e)},getAllKeys(){return wx.getStorageInfoSync().keys},getSizeBytes(){return wx.getStorageInfoSync().currentSize*1024}};let r=new Map;return{setItem(e,t){r.set(e,t)},getItem(e){return r.get(e)},removeItem(e){r.delete(e)},getAllKeys(){return Array.from(r.keys())},getSizeBytes(){return Array.from(r.values()).reduce((e,t)=>e+t.length,0)}}}var y="sanguo_save_";function m(r){return JSON.parse(JSON.stringify(r))}function de(r){return typeof Blob!="undefined"?new Blob([r]).size:typeof TextEncoder!="undefined"?new TextEncoder().encode(r).length:r.length*2}function ue(){let r=new Date().toISOString(),e=m(T),t=m(v),n=m(w);return{meta:{version:f,createdAt:r,lastSaved:r,playerId:e.id,saveName:"\u9ED8\u8BA4\u5B58\u6863",saveSlot:0},player:e,world:t,npcs:n,eventLog:[],dialogueHistory:[...I],progress:{totalTurns:0,lastEventId:"",lastEventTime:r},history_logs:[]}}var g=class{constructor(){this.currentSlot=0;this.autoSaveEnabled=!0;this.autoSaveInterval=20;this.autoSaveTimer=null;this.storageLimits={maxSingleKeySize:1048576,maxTotalSize:10485760,maxDialogueHistory:100,maxEventLog:500,warningThreshold:.8};this.storage=ce()}init(){return console.log("\u5B58\u6863\u7CFB\u7EDF\u521D\u59CB\u5316"),this.startAutoSave(),!0}generatePlayerId(){return`player_${Date.now()}_${Math.floor(Math.random()*1e4)}`}createNewSave(e=0,t="\u65B0\u5EFA\u5B58\u6863"){return this.createNewSaveWithConfig(e,t,null)}createNewSaveWithConfig(e=0,t,n){var l,_,A,N;let i=m(ue()),o=this.generatePlayerId(),a=new Date().toISOString();return i.meta=h(s({},i.meta),{playerId:o,createdAt:a,lastSaved:a,saveName:t,saveSlot:e}),i.player.id=o,n&&(i.player.name=n.name.trim(),i.player.gender=n.gender,n.ambition!=null&&(i.player.ambition=n.ambition),i.player.attrs={strength:d+((l=n.attrBonus.strength)!=null?l:0),intelligence:d+((_=n.attrBonus.intelligence)!=null?_:0),charm:d+((A=n.attrBonus.charm)!=null?A:0),luck:d+((N=n.attrBonus.luck)!=null?N:0)}),this.currentSlot=e,i}optimizeSaveData(e){let t=h(s({},e),{dialogueHistory:e.dialogueHistory.length>this.storageLimits.maxDialogueHistory?e.dialogueHistory.slice(-this.storageLimits.maxDialogueHistory):e.dialogueHistory,eventLog:e.eventLog.length>this.storageLimits.maxEventLog?e.eventLog.slice(-this.storageLimits.maxEventLog):e.eventLog});return delete t.tempData,t}checkSaveSize(e){try{let t=JSON.stringify(e),n=de(t),i=n<=this.storageLimits.maxSingleKeySize;return{size:n,withinLimit:i,warning:n>this.storageLimits.maxSingleKeySize*this.storageLimits.warningThreshold?`\u5B58\u6863\u5927\u5C0F ${n} \u5B57\u8282\u63A5\u8FD1\u5355\u952E\u9650\u5236`:null}}catch(t){return console.error("\u68C0\u67E5\u5B58\u6863\u5927\u5C0F\u5931\u8D25:",t),{size:0,withinLimit:!1,warning:null}}}checkTotalStorage(){try{let e=this.storage.getSizeBytes(),t=e/this.storageLimits.maxTotalSize;return{totalSize:e,usagePercentage:t,withinLimit:e<=this.storageLimits.maxTotalSize,warning:t>this.storageLimits.warningThreshold?`\u5B58\u50A8\u4F7F\u7528\u7387 ${(t*100).toFixed(1)}% \u63A5\u8FD1\u4E0A\u9650`:null}}catch(e){return console.error("\u68C0\u67E5\u5B58\u50A8\u4F7F\u7528\u60C5\u51B5\u5931\u8D25:",e),null}}save(e,t=!1){if(!e)return console.error("\u5B58\u6863\u6570\u636E\u4E0D\u80FD\u4E3A\u7A7A"),!1;let n=new Date().toISOString();e.meta.lastSaved=n,t&&(e.meta.lastAutoSave=n);let i=this.optimizeSaveData(e),o=this.checkSaveSize(i);if(!o.withinLimit&&(console.error(`\u5B58\u6863\u5927\u5C0F ${o.size} \u5B57\u8282\u8D85\u8FC7\u9650\u5236\uFF0C\u5C1D\u8BD5\u88C1\u526A...`),i.dialogueHistory=i.dialogueHistory.slice(-50),i.eventLog=i.eventLog.slice(-100),!this.checkSaveSize(i).withinLimit))return console.error("\u88C1\u526A\u540E\u4ECD\u8D85\u8FC7\u9650\u5236\uFF0C\u4FDD\u5B58\u5931\u8D25"),!1;o.warning&&console.warn(o.warning);let a=this.checkTotalStorage();a!=null&&a.warning&&console.warn(a.warning);let l=`${y}${this.currentSlot}`;try{let _=JSON.stringify(i);return this.storage.setItem(l,_),console.log(`\u5B58\u6863\u4FDD\u5B58\u6210\u529F\uFF08${t?"\u81EA\u52A8":"\u624B\u52A8"}\uFF09\uFF0C\u69FD\u4F4D: ${this.currentSlot}`),!0}catch(_){return console.error("\u5B58\u6863\u4FDD\u5B58\u5931\u8D25:",_),!1}}readSlot(e){let t=`${y}${e}`;try{let n=this.storage.getItem(t);if(!n)return null;let i=JSON.parse(n);return i.meta.version!==f&&console.warn(`\u5B58\u6863\u7248\u672C\u4E0D\u5339\u914D: ${i.meta.version} -> ${f}`),U(i)}catch(n){return console.error("\u5B58\u6863\u8BFB\u53D6\u5931\u8D25:",n),null}}load(e=null){var n,i;let t=e!=null?e:this.currentSlot;try{let o=this.readSlot(t);return o?(o.dialogueHistory=_e((n=o.dialogueHistory)!=null?n:[]),o.player&&(o.player.stamina==null&&(o.player.stamina=80),o.player.birth_year==null&&(o.player.birth_year=169)),(i=o.npcs)!=null&&i.length&&o.npcs.forEach(a=>{a.player_favor==null&&(a.player_favor=0),a.player_relation==null&&(a.player_relation="")}),this.currentSlot=t,o):(console.log(`\u5B58\u6863\u69FD\u4F4D ${t} \u4E0D\u5B58\u5728`),null)}catch(o){return console.error("\u5B58\u6863\u52A0\u8F7D\u5931\u8D25:",o),null}}deleteSave(e){let t=`${y}${e}`;try{return this.storage.removeItem(t),console.log(`\u5B58\u6863\u5220\u9664\u6210\u529F\uFF0C\u69FD\u4F4D: ${e}`),!0}catch(n){return console.error("\u5B58\u6863\u5220\u9664\u5931\u8D25:",n),!1}}getSaveList(){let e=[];for(let t=0;t<10;t+=1){let n=this.readSlot(t);n&&e.push({slot:t,name:n.meta.saveName,playerId:n.meta.playerId,lastSaved:n.meta.lastSaved,era:n.world.era,location:n.player.location.region})}return e}logEvent(e,t,n){if(!e||!t)return console.error("logEvent \u53C2\u6570\u9519\u8BEF"),!1;let i=n||e.player.id;if(e.eventLog.some(a=>a.eventId===t&&a.playerId===i))return!0;let o=new Date().toISOString();return e.eventLog.push({eventId:t,playerId:i,triggeredAt:o,recordedAt:o}),e.progress.lastEventId=t,e.progress.lastEventTime=o,e.progress.totalTurns+=1,!0}isEventTriggered(e,t){return!e||!t?!1:e.eventLog.some(n=>n.eventId===t&&n.playerId===e.player.id)}updatePlayerAttributes(e,t){var n,i;if(!e||!t)return e;if(t.attrs&&Object.entries(t.attrs).forEach(([o,a])=>{if(typeof a=="number"&&o in e.player.attrs){let l=e.player.attrs[o]+a;e.player.attrs[o]=Math.max(0,Math.min(100,l))}}),typeof t.legend=="number"&&(e.player.legend=Math.max(0,e.player.legend+t.legend)),typeof t.reputation=="number"){let o=e.player.reputation+t.reputation;e.player.reputation=Math.max(0,Math.min(100,o))}return typeof t.fame=="number"&&(e.player.fame=Math.max(0,((n=e.player.fame)!=null?n:0)+t.fame)),typeof t.infamy=="number"&&(e.player.infamy=Math.max(0,((i=e.player.infamy)!=null?i:0)+t.infamy)),t.resources&&Object.entries(t.resources).forEach(([o,a])=>{if(typeof a=="number"&&o in e.player.resources){let l=e.player.resources[o]+a;e.player.resources[o]=Math.max(0,l)}}),e}updateWorldState(e,t){return!e||!t||(t.era&&(e.world.era=t.era),t.flags&&t.flags.forEach(n=>{e.world.flags.includes(n)||e.world.flags.push(n)}),t.time&&(e.world.time=s(s({},e.world.time),t.time)),t.regions&&(e.world.regions=e.world.regions||{},Object.entries(t.regions).forEach(([n,i])=>{e.world.regions[n]=s(s({},e.world.regions[n]||{}),i)}))),e}addDialogueHistory(e,t){return!e||!t||(Array.isArray(t)?e.dialogueHistory.push(...t):e.dialogueHistory.push(t),e.dialogueHistory.length>this.storageLimits.maxDialogueHistory&&(e.dialogueHistory=e.dialogueHistory.slice(-this.storageLimits.maxDialogueHistory))),e}startAutoSave(){!this.autoSaveEnabled||this.autoSaveTimer||(this.autoSaveTimer=setInterval(()=>{let e=this.load(this.currentSlot);e&&setTimeout(()=>this.save(e,!0),0)},this.autoSaveInterval*1e3),console.log(`\u81EA\u52A8\u4FDD\u5B58\u5DF2\u542F\u52A8\uFF0C\u95F4\u9694: ${this.autoSaveInterval} \u79D2`))}stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,console.log("\u81EA\u52A8\u4FDD\u5B58\u5DF2\u505C\u6B62"))}setAutoSaveInterval(e){this.autoSaveInterval=Math.max(10,e),this.autoSaveTimer&&(this.stopAutoSave(),this.startAutoSave())}exportSave(e=null){let t=this.load(e!=null?e:this.currentSlot);return t?JSON.stringify(t,null,2):null}importSave(e,t){try{let n=JSON.parse(e);if(!n.meta||!n.player)throw new Error("\u5B58\u6863\u683C\u5F0F\u65E0\u6548");return typeof t=="number"&&(this.currentSlot=t),this.save(U(n),!1)}catch(n){return console.error("\u5BFC\u5165\u5B58\u6863\u5931\u8D25:",n),!1}}getStorageInfo(){let e=this.storage.getSizeBytes(),t=this.storageLimits.maxTotalSize;return{total:t,used:e,available:Math.max(0,t-e),usagePercentage:e/t,keys:this.storage.getAllKeys()}}},pe=new g;
