"use strict";var z=Object.defineProperty,Xe=Object.defineProperties,Qe=Object.getOwnPropertyDescriptor,Ze=Object.getOwnPropertyDescriptors,et=Object.getOwnPropertyNames,pe=Object.getOwnPropertySymbols;var me=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var ye=(t,e,n)=>e in t?z(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_=(t,e)=>{for(var n in e||(e={}))me.call(e,n)&&ye(t,n,e[n]);if(pe)for(var n of pe(e))tt.call(e,n)&&ye(t,n,e[n]);return t},Se=(t,e)=>Xe(t,Ze(e));var nt=(t,e)=>{for(var n in e)z(t,n,{get:e[n],enumerable:!0})},rt=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of et(e))!me.call(t,a)&&a!==n&&z(t,a,{get:()=>e[a],enumerable:!(r=Qe(e,a))||r.enumerable});return t};var at=t=>rt(z({},"__esModule",{value:!0}),t);var _t={};nt(_t,{gameLoop:()=>Be,getState:()=>qe,handleTouch:()=>ce,initGame:()=>$e,loadLatestSave:()=>V,manualSave:()=>Y,onAppHide:()=>Fe,render:()=>h,setCurrentInput:()=>Ve,showKeyboard:()=>de,submitInput:()=>B,toggleSaveLoadPanel:()=>$});module.exports=at(_t);var m={id:"player_001",attrs:{strength:75,intelligence:82,charm:68,luck:55},legend:30,tags:["civilian"],reputation:50,resources:{gold:100,food:200,soldiers:0},location:{region:"yingchuan",scene:"village"}},U={era:"184",flags:["taipingdao_spread=high"],time:{year:184,month:2,day:1},regionStatus:{jingzhou:"stable",yuzhou:"turmoil",jizhou:"stable"}},M=["\u5EFA\u5B81\u5143\u5E74\uFF08\u516C\u5143168\u5E74\uFF09\uFF0C\u4F60\u9192\u6765\u53D1\u73B0\u81EA\u5DF1\u8EAB\u5904\u6D1B\u9633\u57CE\u5916\u7684\u5C0F\u6751\u5E84\u3002","\u6751\u4E2D\u957F\u8005\u544A\u8BC9\u4F60\uFF0C\u9EC4\u5DFE\u4E4B\u4E71\u5373\u5C06\u7206\u53D1\uFF0C\u5929\u4E0B\u5C06\u4E71\u3002","\u4F60\u53EF\u4EE5\u9009\u62E9\u6295\u9760\u5B98\u5E9C\uFF0C\u4E5F\u53EF\u4EE5\u6697\u4E2D\u7ED3\u4EA4\u8C6A\u6770\uFF0C\u751A\u81F3\u52A0\u5165\u592A\u5E73\u9053\u2026\u2026","\u3010\u63D0\u793A\u3011\u5728\u4E0B\u65B9\u8F93\u5165\u6846\u8F93\u5165\u4F60\u7684\u610F\u56FE\uFF08\u5982\u300C\u524D\u5F80\u6D1B\u9633\u300D\u300C\u7ED3\u8BC6\u8C6A\u6770\u300D\uFF09\uFF0C\u70B9\u51FB\u53D1\u9001\u5373\u53EF\u63A8\u8FDB\u5267\u60C5\u3002"],N=[{id:"caocao",name:"\u66F9\u64CD",stance:"neutral",trust:30,location:"luoyang"},{id:"liubei",name:"\u5218\u5907",stance:"friendly",trust:50,location:"zhuoxian"}],O=(()=>{try{let e=(typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:{}).process;return e&&typeof e=="object"&&e!==null&&"env"in e?e.env||{}:{}}catch(t){return{}}})(),L={CLOUD_ENV:O.CLOUD_ENV||"cloud1-3gfb9ep2701c4857",ADJUDICATION_API:O.ADJUDICATION_API||"http://localhost:3000/intent/resolve",MAX_RETRIES:2,RETRY_DELAY:1e3,REQUEST_TIMEOUT:15e3,DEBUG:O.NODE_ENV!=="production",DEBUG_TOUCH:O.DEBUG_TOUCH==="true",AD_UNIT_ID:O.AD_UNIT_ID||"adunit-1234567890abcdef",DEFAULT_PLAYER_STATE:m,DEFAULT_WORLD_STATE:U,DEFAULT_NPC_STATE:N};var ot={};function ve(t,e){let n=ot[t];return!n||n.size===0?e:e.filter(r=>r.id!=null?n.has(r.id):!1)}function be(t){var u,c,l,d,f;let{saveData:e,playerIntent:n,recentDialogue:r=(c=(u=e==null?void 0:e.dialogueHistory)==null?void 0:u.slice(-5))!=null?c:[]}=t,a=(l=e==null?void 0:e.player)!=null?l:m,i=(d=e==null?void 0:e.world)!=null?d:U,s=(f=e==null?void 0:e.npcs)!=null?f:N;return s=ve("npc",s),{player_state:a,world_state:i,npc_state:s,event_context:r.length>0?{recent_dialogue:r}:void 0,player_intent:n}}function xe(){return{value:"",isKeyboardVisible:!1}}function q(t,e){return t.value=e,t}function J(t){return t.value="",t}function k(t,e){return t.isKeyboardVisible=e,t}function we(t,e,n=0){var H;let r,a;typeof t=="object"?(r=t.screenWidth,a=t.screenHeight,n=(H=t.safeAreaTop)!=null?H:0):(r=t,a=e!=null?e:667);let i=Math.max(0,n),s=Math.max(16,Math.min(24,Math.round(r*.04))),u=r-s*2,c=Math.max(10,Math.round(a*.012)),l=Math.max(90,Math.min(100,Math.round(a*.1))),d=Math.max(72,Math.min(88,Math.round(a*.11))),f=Math.max(64,Math.min(80,Math.round(a*.09))),p={x:s,y:s+i,width:u,height:l},A={x:s,y:a-s-d,width:u,height:d},y={x:s,y:A.y-c-f,width:u,height:f},P={x:s,y:p.y+p.height+c,width:u,height:y.y-(p.y+p.height)-c*2};return{safeMargin:s,attributePanel:p,dialogueArea:P,inputArea:A,saveLoadPanel:y}}var x={canvas:null,ctx:null,cacheKey:"",totalHeight:0};function it(t,e,n){try{if(typeof OffscreenCanvas!="undefined")return new OffscreenCanvas(t,e);let r=n.canvas;if(r!=null&&r.createOffscreenCanvas)return r.createOffscreenCanvas(t,e);if(typeof document!="undefined"&&document.createElement){let a=document.createElement("canvas");return a.width=t,a.height=e,a}}catch(r){}return null}var Te=["\u524D\u5F80\u6D1B\u9633","\u6253\u542C\u6D88\u606F","\u7ED3\u8BC6\u8C6A\u6770"],st={yingchuan:"\u988D\u5DDD",luoyang:"\u6D1B\u9633",jingzhou:"\u8346\u5DDE",jizhou:"\u5180\u5DDE",yuzhou:"\u8C6B\u5DDE",zhuoxian:"\u6DBF\u53BF"},lt={village:"\u6751\u5E84",city:"\u57CE\u5185",camp:"\u8425\u5730",inn:"\u5BA2\u6808",temple:"\u5E99\u5B87"},g={bgStart:"#0f172a",bgEnd:"#1e293b",panel:"rgba(30, 41, 59, 0.92)",panelBorder:"rgba(148, 163, 184, 0.2)",dialogueBg:"rgba(15, 23, 42, 0.85)",bubbleSystem:"rgba(255,255,255,0.06)",bubblePlayer:"rgba(56, 189, 248, 0.12)",bubblePlayerBorder:"rgba(56, 189, 248, 0.35)",textPrimary:"#f8fafc",textSecondary:"#94a3b8",textMuted:"#64748b",accent:"#38bdf8",success:"#4ade80",warn:"#fb7185"};function Ce(t){let{ctx:e,screenWidth:n,screenHeight:r}=t;ut(e,n,r),ct(t),ft(t),gt(t),ht(t)}function ut(t,e,n){let r=t.createLinearGradient(0,0,0,n);r.addColorStop(0,g.bgStart),r.addColorStop(1,g.bgEnd),t.fillStyle=r,t.fillRect(0,0,e,n)}function ct({ctx:t,layout:e,playerAttributes:n,currentSaveData:r}){var P,H,S,b,I,R,D,j;let a=e.attributePanel,i=14;E(t,a,g.panel,g.panelBorder),t.fillStyle=g.accent,t.font="bold 14px 'PingFang SC', sans-serif",t.textAlign="left",t.fillText("\u73A9\u5BB6\u5C5E\u6027",a.x+i,a.y+16);let s=["\u6B66\u529B","\u667A\u529B","\u9B45\u529B","\u8FD0\u6C14","\u4F20\u5947","\u6C14\u52BF"],u=[n.strength,n.intelligence,n.charm,n.luck,n.legend,Math.max(0,Math.round(n.legend/10))],c=(a.width-i*2)/6;t.font="13px 'PingFang SC', sans-serif",s.forEach((Je,fe)=>{let ge=a.x+i+c*fe+c/2,he=a.y+36;t.fillStyle=g.textMuted,t.textAlign="center",t.fillText(Je,ge,he-2),t.fillStyle=g.textPrimary,t.fillText(String(u[fe]),ge,he+14)});let l=(S=(H=(P=r==null?void 0:r.player)==null?void 0:P.location)==null?void 0:H.region)!=null?S:"",d=(R=(I=(b=r==null?void 0:r.player)==null?void 0:b.location)==null?void 0:I.scene)!=null?R:"",f=((D=st[l])!=null?D:l)||"\u2014",p=((j=lt[d])!=null?j:d)||"\u2014",A=`${f} \xB7 ${p}`;t.fillStyle=g.textMuted,t.font="11px 'PingFang SC', sans-serif",t.textAlign="left",t.fillText(A,a.x+i,a.y+a.height-8);let y=r?"\u5DF2\u5B58\u6863":"\u65B0\u6E38\u620F";t.fillStyle=r?g.success:g.warn,t.textAlign="right",t.fillText(`${y} \xB7 \u70B9\u51FB\u5B58\u6863`,a.x+a.width-i,a.y+a.height-8)}function dt(t,e,n){t.save(),t.font="14px 'PingFang SC', sans-serif";let i=Ie(t,e,n-24);return t.restore(),i.length*22+24}function ft(t){let{ctx:e,layout:n,dialogueHistory:r,dialogueScrollOffset:a=0}=t,i=n.dialogueArea,s=14,u=8,c=i.width-s*2,l=r,d=i.height-s*2,f=[];l.forEach(S=>{f.push(dt(e,S,c))});let p=f.reduce((S,b)=>S+b+u,-u),A=Math.max(0,p-d),y=Math.min(a,A),P=`${l.join("")}|${i.width}x${i.height}`;if((x.cacheKey!==P||!x.canvas||x.totalHeight!==p)&&p>0){let S=it(i.width,p,e);if(S){let b=S.getContext("2d");if(b){let I=0;l.forEach(R=>{let D=R.startsWith("\u4F60\u8BF4\uFF1A"),j=Ae(b,{x:s,y:I,width:c,text:R,player:D});I+=j+u}),x.canvas=S,x.ctx=b,x.cacheKey=P,x.totalHeight=p}}else x.cacheKey="",x.canvas=null,x.ctx=null,x.totalHeight=0}if(E(e,i,g.dialogueBg,"rgba(148,163,184,0.12)"),e.save(),e.beginPath(),e.rect(i.x,i.y,i.width,i.height),e.clip(),x.canvas&&x.ctx){let S=Math.max(0,p-d-y),b=Math.min(d,p-S),I=i.y+s;e.drawImage(x.canvas,0,S,i.width,b,i.x,I,i.width,b)}else{let S=i.height-p-s*2;e.translate(0,S+y);let b=i.y+s;l.forEach(I=>{let R=I.startsWith("\u4F60\u8BF4\uFF1A"),D=Ae(e,{x:i.x+s,y:b,width:c,text:I,player:R});b+=D+u})}e.restore(),A>0&&y<A-2&&(e.fillStyle=g.accent,e.font="12px 'PingFang SC', sans-serif",e.textAlign="center",e.fillText("\u2191 \u4E0A\u6ED1\u67E5\u770B\u5386\u53F2\u5BF9\u8BDD",i.x+i.width/2,i.y+i.height-8))}function gt({ctx:t,layout:e,currentInput:n,keyboardActive:r,placeholderIndex:a}){let i=e.inputArea,s=12,u=64,c=10;E(t,i,g.panel,g.panelBorder);let l={x:i.x+s,y:i.y+s,width:i.width-s*2-u-c,height:i.height-s*2};E(t,l,"rgba(15,23,42,0.9)","rgba(148,163,184,0.2)",10);let d=(a!=null?a:0)%Te.length,f=n?"":r?"\u8F93\u5165\u4E2D...":Te[d];t.fillStyle=n?g.textPrimary:g.textMuted,t.font="14px 'PingFang SC', sans-serif",t.textAlign="left";let p=n||f,A=l.y+l.height/2+5;t.fillText(p||" ",l.x+12,A);let y={x:i.x+i.width-s-u,y:i.y+s,width:u,height:i.height-s*2};pt(t,y,"\u53D1\u9001")}function ht({ctx:t,layout:e,currentSaveData:n}){if(!e.saveLoadPanel)return;let r=e.saveLoadPanel,a=10,i=8,s=(r.width-a*2-i)/2,u=r.height-a*2;if(E(t,r,g.panel,g.panelBorder),[{label:"\u4FDD\u5B58",x:r.x+a},{label:"\u5173\u95ED",x:r.x+a+s+i}].forEach(({label:l,x:d})=>{E(t,{x:d,y:r.y+a,width:s,height:u},"rgba(15,23,42,0.9)","rgba(148,163,184,0.2)",10),t.fillStyle=g.textPrimary,t.font="bold 13px 'PingFang SC', sans-serif",t.textAlign="center",t.fillText(l,d+s/2,r.y+a+u/2+4)}),n){t.fillStyle=g.textMuted,t.font="11px 'PingFang SC', sans-serif",t.textAlign="left";let l=r.y+r.height-6;t.fillText(`${n.meta.saveName} \xB7 ${new Date(n.meta.lastSaved).toLocaleDateString()}`,r.x+a,l)}}function Ae(t,e){let a=e.width-24,i=Ie(t,e.text,a),s=i.length*22+24;return t.save(),E(t,{x:e.x,y:e.y,width:e.width,height:s},e.player?g.bubblePlayer:g.bubbleSystem,e.player?g.bubblePlayerBorder:"rgba(255,255,255,0.08)",10),t.fillStyle=e.player?g.textPrimary:g.textSecondary,t.font="14px 'PingFang SC', sans-serif",t.textAlign="left",i.forEach((u,c)=>{t.fillText(u,e.x+12,e.y+12+22*(c+.82))}),t.restore(),s}function Ie(t,e,n){let r=Array.from(e),a=[],i="";return r.forEach(s=>{let u=i+s;t.measureText(u).width>n&&i?(a.push(i),i=s):i=u}),i&&a.push(i),a}function E(t,e,n,r,a=18){let{x:i,y:s,width:u,height:c}=e;t.save(),t.beginPath(),t.moveTo(i+a,s),t.lineTo(i+u-a,s),t.quadraticCurveTo(i+u,s,i+u,s+a),t.lineTo(i+u,s+c-a),t.quadraticCurveTo(i+u,s+c,i+u-a,s+c),t.lineTo(i+a,s+c),t.quadraticCurveTo(i,s+c,i,s+c-a),t.lineTo(i,s+a),t.quadraticCurveTo(i,s,i+a,s),t.closePath(),t.fillStyle=n,t.fill(),r&&(t.strokeStyle=r,t.lineWidth=1,t.stroke()),t.restore()}function pt(t,e,n){let r=t.createLinearGradient(e.x,e.y,e.x+e.width,e.y+e.height);r.addColorStop(0,"#38bdf8"),r.addColorStop(1,"#3b82f6"),E(t,e,r,void 0,10),t.fillStyle="#0f172a",t.font="bold 14px 'PingFang SC', sans-serif",t.textAlign="center",t.fillText(n,e.x+e.width/2,e.y+e.height/2+4)}var Q="1.0.0";function yt(){if(typeof wx!="undefined"&&typeof wx.setStorageSync=="function")return{setItem(e,n){wx.setStorageSync(e,n)},getItem(e){let n=wx.getStorageSync(e);return n===""?void 0:n},removeItem(e){wx.removeStorageSync(e)},getAllKeys(){return wx.getStorageInfoSync().keys},getSizeBytes(){return wx.getStorageInfoSync().currentSize*1024}};let t=new Map;return{setItem(e,n){t.set(e,n)},getItem(e){return t.get(e)},removeItem(e){t.delete(e)},getAllKeys(){return Array.from(t.keys())},getSizeBytes(){return Array.from(t.values()).reduce((e,n)=>e+n.length,0)}}}var X="sanguo_save_";function G(t){return JSON.parse(JSON.stringify(t))}function mt(t){return typeof Blob!="undefined"?new Blob([t]).size:typeof TextEncoder!="undefined"?new TextEncoder().encode(t).length:t.length*2}function St(){let t=new Date().toISOString(),e=G(m),n=G(U),r=G(N);return{meta:{version:Q,createdAt:t,lastSaved:t,playerId:e.id,saveName:"\u9ED8\u8BA4\u5B58\u6863",saveSlot:0},player:e,world:n,npcs:r,eventLog:[],dialogueHistory:[...M],progress:{totalTurns:0,lastEventId:"",lastEventTime:t}}}var Z=class{constructor(){this.currentSlot=0;this.autoSaveEnabled=!0;this.autoSaveInterval=20;this.autoSaveTimer=null;this.storageLimits={maxSingleKeySize:1048576,maxTotalSize:10485760,maxDialogueHistory:100,maxEventLog:500,warningThreshold:.8};this.storage=yt()}init(){return console.log("\u5B58\u6863\u7CFB\u7EDF\u521D\u59CB\u5316"),this.startAutoSave(),!0}generatePlayerId(){return`player_${Date.now()}_${Math.floor(Math.random()*1e4)}`}createNewSave(e=0,n="\u65B0\u5EFA\u5B58\u6863"){let r=G(St()),a=this.generatePlayerId(),i=new Date().toISOString();return r.meta=Se(_({},r.meta),{playerId:a,createdAt:i,lastSaved:i,saveName:n,saveSlot:e}),r.player.id=a,this.currentSlot=e,r}optimizeSaveData(e){let n=G(e);return n.dialogueHistory.length>this.storageLimits.maxDialogueHistory&&(n.dialogueHistory=n.dialogueHistory.slice(-this.storageLimits.maxDialogueHistory)),n.eventLog.length>this.storageLimits.maxEventLog&&(n.eventLog=n.eventLog.slice(-this.storageLimits.maxEventLog)),delete n.tempData,n}checkSaveSize(e){try{let n=JSON.stringify(e),r=mt(n),a=r<=this.storageLimits.maxSingleKeySize;return{size:r,withinLimit:a,warning:r>this.storageLimits.maxSingleKeySize*this.storageLimits.warningThreshold?`\u5B58\u6863\u5927\u5C0F ${r} \u5B57\u8282\u63A5\u8FD1\u5355\u952E\u9650\u5236`:null}}catch(n){return console.error("\u68C0\u67E5\u5B58\u6863\u5927\u5C0F\u5931\u8D25:",n),{size:0,withinLimit:!1,warning:null}}}checkTotalStorage(){try{let e=this.storage.getSizeBytes(),n=e/this.storageLimits.maxTotalSize;return{totalSize:e,usagePercentage:n,withinLimit:e<=this.storageLimits.maxTotalSize,warning:n>this.storageLimits.warningThreshold?`\u5B58\u50A8\u4F7F\u7528\u7387 ${(n*100).toFixed(1)}% \u63A5\u8FD1\u4E0A\u9650`:null}}catch(e){return console.error("\u68C0\u67E5\u5B58\u50A8\u4F7F\u7528\u60C5\u51B5\u5931\u8D25:",e),null}}save(e,n=!1){if(!e)return console.error("\u5B58\u6863\u6570\u636E\u4E0D\u80FD\u4E3A\u7A7A"),!1;let r=new Date().toISOString();e.meta.lastSaved=r,n&&(e.meta.lastAutoSave=r);let a=this.optimizeSaveData(e),i=this.checkSaveSize(a);if(!i.withinLimit&&(console.error(`\u5B58\u6863\u5927\u5C0F ${i.size} \u5B57\u8282\u8D85\u8FC7\u9650\u5236\uFF0C\u5C1D\u8BD5\u88C1\u526A...`),a.dialogueHistory=a.dialogueHistory.slice(-50),a.eventLog=a.eventLog.slice(-100),!this.checkSaveSize(a).withinLimit))return console.error("\u88C1\u526A\u540E\u4ECD\u8D85\u8FC7\u9650\u5236\uFF0C\u4FDD\u5B58\u5931\u8D25"),!1;i.warning&&console.warn(i.warning);let s=this.checkTotalStorage();s!=null&&s.warning&&console.warn(s.warning);let u=`${X}${this.currentSlot}`;try{let c=JSON.stringify(a);return this.storage.setItem(u,c),console.log(`\u5B58\u6863\u4FDD\u5B58\u6210\u529F\uFF08${n?"\u81EA\u52A8":"\u624B\u52A8"}\uFF09\uFF0C\u69FD\u4F4D: ${this.currentSlot}`),!0}catch(c){return console.error("\u5B58\u6863\u4FDD\u5B58\u5931\u8D25:",c),!1}}readSlot(e){let n=`${X}${e}`;try{let r=this.storage.getItem(n);if(!r)return null;let a=JSON.parse(r);return a.meta.version!==Q&&console.warn(`\u5B58\u6863\u7248\u672C\u4E0D\u5339\u914D: ${a.meta.version} -> ${Q}`),a}catch(r){return console.error("\u5B58\u6863\u8BFB\u53D6\u5931\u8D25:",r),null}}load(e=null){let n=e!=null?e:this.currentSlot;try{let r=this.readSlot(n);return r?(this.currentSlot=n,r):(console.log(`\u5B58\u6863\u69FD\u4F4D ${n} \u4E0D\u5B58\u5728`),null)}catch(r){return console.error("\u5B58\u6863\u52A0\u8F7D\u5931\u8D25:",r),null}}deleteSave(e){let n=`${X}${e}`;try{return this.storage.removeItem(n),console.log(`\u5B58\u6863\u5220\u9664\u6210\u529F\uFF0C\u69FD\u4F4D: ${e}`),!0}catch(r){return console.error("\u5B58\u6863\u5220\u9664\u5931\u8D25:",r),!1}}getSaveList(){let e=[];for(let n=0;n<10;n+=1){let r=this.readSlot(n);r&&e.push({slot:n,name:r.meta.saveName,playerId:r.meta.playerId,lastSaved:r.meta.lastSaved,era:r.world.era,location:r.player.location.region})}return e}logEvent(e,n,r){if(!e||!n)return console.error("logEvent \u53C2\u6570\u9519\u8BEF"),!1;let a=r||e.player.id;if(e.eventLog.some(s=>s.eventId===n&&s.playerId===a))return!0;let i=new Date().toISOString();return e.eventLog.push({eventId:n,playerId:a,triggeredAt:i,recordedAt:i}),e.progress.lastEventId=n,e.progress.lastEventTime=i,e.progress.totalTurns+=1,!0}isEventTriggered(e,n){return!e||!n?!1:e.eventLog.some(r=>r.eventId===n&&r.playerId===e.player.id)}updatePlayerAttributes(e,n){if(!e||!n)return e;if(n.attrs&&Object.entries(n.attrs).forEach(([r,a])=>{if(typeof a=="number"&&r in e.player.attrs){let i=e.player.attrs[r]+a;e.player.attrs[r]=Math.max(0,Math.min(100,i))}}),typeof n.legend=="number"&&(e.player.legend=Math.max(0,e.player.legend+n.legend)),typeof n.reputation=="number"){let r=e.player.reputation+n.reputation;e.player.reputation=Math.max(0,Math.min(100,r))}return n.resources&&Object.entries(n.resources).forEach(([r,a])=>{if(typeof a=="number"&&r in e.player.resources){let i=e.player.resources[r]+a;e.player.resources[r]=Math.max(0,i)}}),e}updateWorldState(e,n){return!e||!n||(n.era&&(e.world.era=n.era),n.flags&&n.flags.forEach(r=>{e.world.flags.includes(r)||e.world.flags.push(r)}),n.time&&(e.world.time=_(_({},e.world.time),n.time)),n.regions&&(e.world.regions=e.world.regions||{},Object.entries(n.regions).forEach(([r,a])=>{e.world.regions[r]=_(_({},e.world.regions[r]||{}),a)}))),e}addDialogueHistory(e,n){return!e||!n||(Array.isArray(n)?e.dialogueHistory.push(...n):e.dialogueHistory.push(n),e.dialogueHistory.length>this.storageLimits.maxDialogueHistory&&(e.dialogueHistory=e.dialogueHistory.slice(-this.storageLimits.maxDialogueHistory))),e}startAutoSave(){!this.autoSaveEnabled||this.autoSaveTimer||(this.autoSaveTimer=setInterval(()=>{let e=this.load(this.currentSlot);e&&this.save(e,!0)},this.autoSaveInterval*1e3),console.log(`\u81EA\u52A8\u4FDD\u5B58\u5DF2\u542F\u52A8\uFF0C\u95F4\u9694: ${this.autoSaveInterval} \u79D2`))}stopAutoSave(){this.autoSaveTimer&&(clearInterval(this.autoSaveTimer),this.autoSaveTimer=null,console.log("\u81EA\u52A8\u4FDD\u5B58\u5DF2\u505C\u6B62"))}setAutoSaveInterval(e){this.autoSaveInterval=Math.max(10,e),this.autoSaveTimer&&(this.stopAutoSave(),this.startAutoSave())}exportSave(e=null){let n=this.load(e!=null?e:this.currentSlot);return n?JSON.stringify(n,null,2):null}importSave(e,n){try{let r=JSON.parse(e);if(!r.meta||!r.player)throw new Error("\u5B58\u6863\u683C\u5F0F\u65E0\u6548");return typeof n=="number"&&(this.currentSlot=n),this.save(r,!1)}catch(r){return console.error("\u5BFC\u5165\u5B58\u6863\u5931\u8D25:",r),!1}}getStorageInfo(){let e=this.storage.getSizeBytes(),n=this.storageLimits.maxTotalSize;return{total:n,used:e,available:Math.max(0,n-e),usagePercentage:e/n,keys:this.storage.getAllKeys()}}},v=new Z;function w(t,e,n=120){return Array.isArray(e)?t.push(...e):t.push(e),vt(t,n),t}function ee(t){return t.pop()}function vt(t,e){t.length>e&&t.splice(0,t.length-e)}function C(){return typeof wx!="undefined"}function bt(){return wx}function te(){var r,a,i;let t=bt().getSystemInfoSync(),e=(r=t.statusBarHeight)!=null?r:0,n=(i=(a=t.safeArea)==null?void 0:a.top)!=null?i:e;return{windowWidth:t.windowWidth||375,windowHeight:t.windowHeight||667,pixelRatio:t.pixelRatio||2,statusBarHeight:e,safeAreaTop:Math.max(e,n,0)}}function Pe(){if(!C()||typeof wx.createCanvas!="function")return null;let t=te(),e=wx.createCanvas();return e.width=t.windowWidth*t.pixelRatio,e.height=t.windowHeight*t.pixelRatio,e}function Le(t){if(!C())return;let e=wx.onTouchStart;if(typeof e!="function"){console.warn("[wxHelpers] wx.onTouchStart \u4E0D\u53EF\u7528\uFF0C\u89E6\u6478\u5C06\u65E0\u6CD5\u54CD\u5E94");return}e.call(wx,t)}function Ee(t){if(!C())return;let e=wx.onTouchMove;typeof e=="function"&&e.call(wx,t)}function Re(t){if(!C())return;let e=wx.onTouchEnd;typeof e=="function"&&e.call(wx,t)}function He(t){!C()||typeof wx.onKeyboardInput!="function"||wx.onKeyboardInput(t)}function De(t){!C()||typeof wx.onKeyboardConfirm!="function"||wx.onKeyboardConfirm(t)}function _e(t){!C()||typeof wx.onKeyboardComplete!="function"||wx.onKeyboardComplete(t)}function Me(t,e=100){if(!(!C()||typeof wx.showKeyboard!="function"))try{let n=wx.getSystemInfoSync(),r=String((n==null?void 0:n.platform)||"").toLowerCase();if(r==="devtools"||r==="mac"||r==="windows")return;wx.showKeyboard({defaultValue:t||"",maxLength:Math.max(1,Math.min(e,200)),multiple:!1,confirmHold:!1,confirmType:"done"})}catch(n){try{wx.hideKeyboard({})}catch(r){}}}function ne(){!C()||typeof wx.hideKeyboard!="function"||wx.hideKeyboard({})}function re(t){if(typeof wx!="undefined"&&typeof wx.requestAnimationFrame=="function"){wx.requestAnimationFrame(t);return}setTimeout(()=>t(Date.now()),16)}function Oe(t){return!C()||typeof wx.request!="function"?Promise.reject(new Error("wx.request \u4E0D\u53EF\u7528")):new Promise((e,n)=>{var r;wx.request({url:t.url,data:t.data,method:t.method||"POST",header:t.header||{"Content-Type":"application/json"},timeout:(r=t.timeout)!=null?r:15e3,enableChunked:!0,success(a){e({statusCode:a.statusCode,data:a.data})},fail(a){n(a instanceof Error?a:new Error("wx.request \u8C03\u7528\u5931\u8D25"))}})})}function xt(){var t;return typeof wx!="undefined"&&typeof((t=wx.cloud)==null?void 0:t.callFunction)=="function"}async function Ue(t){let{CLOUD_ENV:e,ADJUDICATION_API:n,MAX_RETRIES:r,RETRY_DELAY:a,REQUEST_TIMEOUT:i}=L;if(xt()&&e)try{let l=await wx.cloud.callFunction({name:"adjudication",data:t}),d=l==null?void 0:l.result;if(d&&typeof d=="object"&&d.result)return d;throw new Error("\u4E91\u51FD\u6570\u8FD4\u56DE\u683C\u5F0F\u5F02\u5E38")}catch(l){throw l instanceof Error?l:new Error("\u4E91\u51FD\u6570\u8C03\u7528\u5931\u8D25")}let u=0,c=null;for(;u<=r;)try{let l=await Oe({url:n,data:t,method:"POST",timeout:i,header:{"Content-Type":"application/json"}});if(l.statusCode>=200&&l.statusCode<300)return l.data;throw new Error(`\u88C1\u51B3 API \u8FD4\u56DE ${l.statusCode}`)}catch(l){if(c=l,u+=1,u>r)break;await new Promise(d=>setTimeout(d,a))}throw c instanceof Error?c:new Error("\u88C1\u51B3\u8BF7\u6C42\u5931\u8D25")}var T=null,W=!1,Ne=!1,ke=12e4,ae=0;function wt(){if(!(T||Ne)&&(Ne=!0,!(typeof wx=="undefined"||typeof wx.createRewardedVideoAd!="function")))try{T=wx.createRewardedVideoAd({adUnitId:L.AD_UNIT_ID}),T.onLoad(()=>{W=!0}),T.onError(()=>{W=!1}),T.onClose(()=>{W=!0})}catch(t){T=null}}function oe(t){let e=Date.now();if(e-ae<ke){console.log(`[ads] trigger=${t}, cooldown active (${Math.ceil((ke-(e-ae))/1e3)}s remaining)`);return}if(wt(),!T||!W){console.log(`[ads] trigger=${t}, but rewarded ad not ready`);return}T.show().then(()=>{ae=Date.now(),W=!1}).catch(()=>{T==null||T.load().then(()=>T==null?void 0:T.show()).catch(n=>{console.warn("[ads] failed to show rewarded ad:",n)})})}var Tt=["\u4F5C\u5F0A\u5668","\u5916\u6302","\u66B4\u6050","\u4F4E\u4FD7","\u8D4C\u535A","\u653F\u6CBB\u654F\u611F","\u6D89\u9EC4","\u8FDD\u6CD5","\u6050\u6016\u88AD\u51FB","\u8272\u60C5","\u53CD\u52A8","\u66B4\u529B","\u8840\u8165","\u6BD2\u54C1","\u8BC8\u9A97","\u4F20\u9500","\u90AA\u6559","\u5206\u88C2","\u98A0\u8986"];function Ge(t){let e=t.toLowerCase();return Tt.some(n=>e.includes(n.toLowerCase()))}function We(t){var r;let e=typeof wx!="undefined"?wx:null,n=(r=e==null?void 0:e.security)==null?void 0:r.msgSecCheck;return typeof n!="function"?Promise.resolve(!0):new Promise(a=>{n({data:{content:t,version:2,scene:2,openid:""},success:()=>a(!0),fail:()=>a(!1)})})}async function Ke(t){return t.trim()?Ge(t)?{allowed:!1,reason:"\u8F93\u5165\u5185\u5BB9\u6D89\u53CA\u654F\u611F\u8BCD\uFF0C\u5DF2\u88AB\u62E6\u622A"}:await We(t)?{allowed:!0}:{allowed:!1,reason:"\u5185\u5BB9\u672A\u901A\u8FC7\u5E73\u53F0\u5BA1\u6838\uFF0C\u8BF7\u8C03\u6574\u540E\u518D\u8BD5"}:{allowed:!1,reason:"\u8BF7\u8F93\u5165\u6709\u6548\u5185\u5BB9"}}async function ie(t){return Ge(t)?{allowed:!1,reason:"\u751F\u6210\u5185\u5BB9\u5305\u542B\u654F\u611F\u4FE1\u606F\uFF0C\u5DF2\u81EA\u52A8\u5C4F\u853D"}:await We(t)?{allowed:!0,text:t}:{allowed:!1,reason:"\u751F\u6210\u5185\u5BB9\u672A\u901A\u8FC7\u5BA1\u6838\uFF0C\u5DF2\u66FF\u6362\u4E3A\u7CFB\u7EDF\u56DE\u590D"}}var o={canvas:null,ctx:null,layout:null,screenWidth:0,screenHeight:0,pixelRatio:1,playerAttributes:{strength:m.attrs.strength,intelligence:m.attrs.intelligence,charm:m.attrs.charm,luck:m.attrs.luck,legend:m.legend},dialogueHistory:[...M],input:xe(),isSaveLoadPanelVisible:!1,currentSaveData:null,isAdjudicating:!1,loopActive:!1,dialogueScrollOffset:0,touchStartY:0,touchStartScroll:0,isDialogueScrollActive:!1},le=!1,je=!1;function K(t,e,n){var i,s;let r=(i=t.x)!=null?i:0,a=(s=t.y)!=null?s:0;return e>=r&&e<=r+t.width&&n>=a&&n<=a+t.height}function h(){if(!o.ctx||!o.layout)return;let t=Math.floor(Date.now()/4e3)%3;Ce({ctx:o.ctx,layout:o.layout,screenWidth:o.screenWidth,screenHeight:o.screenHeight,playerAttributes:o.playerAttributes,dialogueHistory:o.dialogueHistory,currentInput:o.input.value,currentSaveData:o.currentSaveData,isSaveLoadPanelVisible:o.isSaveLoadPanelVisible,keyboardActive:o.input.isKeyboardVisible,dialogueScrollOffset:o.dialogueScrollOffset,placeholderIndex:t})}function ue(){o.currentSaveData&&v.save(o.currentSaveData,!0)}function Fe(){o.currentSaveData&&v.save(o.currentSaveData,!0)}function F(){var t,e,n,r,a;o.currentSaveData&&(o.playerAttributes={strength:(t=o.currentSaveData.player.attrs.strength)!=null?t:m.attrs.strength,intelligence:(e=o.currentSaveData.player.attrs.intelligence)!=null?e:m.attrs.intelligence,charm:(n=o.currentSaveData.player.attrs.charm)!=null?n:m.attrs.charm,luck:(r=o.currentSaveData.player.attrs.luck)!=null?r:m.attrs.luck,legend:(a=o.currentSaveData.player.legend)!=null?a:m.legend},o.dialogueHistory=o.currentSaveData.dialogueHistory.length>0?[...o.currentSaveData.dialogueHistory]:[...M])}function se(){let t=o.dialogueHistory.at(-1);(t!=null&&t.startsWith("\uFF08\u6B63\u5728\u751F\u6210\u5267\u60C5")||t==="\uFF08\u7B49\u5F85\u88C1\u51B3\u7ED3\u679C...\uFF09")&&ee(o.dialogueHistory)}function At(t){var e,n;return be({saveData:o.currentSaveData,playerIntent:t,recentDialogue:(n=(e=o.currentSaveData)==null?void 0:e.dialogueHistory)==null?void 0:n.slice(-5)})}function ze(t){var i,s;if(!o.currentSaveData)return;let e={},n={},r=0,a=0;for(let u of t){let c=u.match(/^([a-zA-Z_]+)([+-]\d+)$/);if(!c)continue;let[,l,d]=c,f=Number(d);Number.isNaN(f)||(l in o.currentSaveData.player.attrs?e[l]=((i=e[l])!=null?i:0)+f:l==="legend"?r+=f:l==="reputation"?a+=f:l in o.currentSaveData.player.resources&&(n[l]=((s=n[l])!=null?s:0)+f))}v.updatePlayerAttributes(o.currentSaveData,{attrs:e,legend:r,reputation:a,resources:n})}function Ct(t){var r,a,i,s,u,c,l;o.dialogueScrollOffset=0;let e=(a=(r=t.result)==null?void 0:r.narrative)!=null?a:"\u4F60\u7684\u4E3E\u52A8\u5F15\u8D77\u4E86\u6CE8\u610F\u3002";ie(e).then(d=>{var f;d.allowed&&d.text?w(o.dialogueHistory,d.text):w(o.dialogueHistory,(f=d.reason)!=null?f:"\u5185\u5BB9\u6682\u65F6\u4E0D\u53EF\u7528"),h()}).catch(()=>{w(o.dialogueHistory,e),h()}),o.currentSaveData&&(v.addDialogueHistory(o.currentSaveData,e),(i=t.state_changes)!=null&&i.player&&t.state_changes.player.length>0&&ze(t.state_changes.player),(s=t.result)!=null&&s.effects&&ze(t.result.effects),(u=t.state_changes)!=null&&u.world&&v.updateWorldState(o.currentSaveData,t.state_changes.world),ue(),F()),((l=(c=t.result)==null?void 0:c.effects)!=null?l:[]).some(d=>d.includes("legend+")||d.includes("gold+"))&&oe("legend-boost")}function It(t){setTimeout(()=>{let e="\u4F60\u7684\u4E3E\u52A8\u5F15\u8D77\u4E86\u53BF\u5C09\u7684\u6CE8\u610F\uFF0C\u4ED6\u5BF9\u4F60\u7684\u884C\u4E3A\u8868\u793A\u8D5E\u8D4F\u3002";ie(e).then(n=>{var r;n.allowed&&n.text?w(o.dialogueHistory,n.text):w(o.dialogueHistory,(r=n.reason)!=null?r:"\u5185\u5BB9\u6682\u65F6\u4E0D\u53EF\u7528")}).finally(()=>{o.currentSaveData&&(v.addDialogueHistory(o.currentSaveData,e),v.updatePlayerAttributes(o.currentSaveData,{attrs:{intelligence:1},reputation:3}),ue(),F()),h()})},1e3)}function Pt(t){let e=t.trim().toLowerCase();return["help","\u5E2E\u52A9","\u6307\u4EE4"].includes(e)?"help":["\u5B58\u6863","\u4FDD\u5B58","save"].includes(e)?"save":["\u8BFB\u6863","\u8F7D\u5165","load"].includes(e)?"load":["\u4F60\u662F\u8C01","who are you","about"].includes(e)?"about":["\u5E7F\u544A","\u798F\u5229","reward"].includes(e)?"ad":null}async function Lt(t){let e=Pt(t);if(!e)return!1;if(e==="help")return w(o.dialogueHistory,["\u3010\u6307\u4EE4\u63D0\u793A\u3011\u76F4\u63A5\u8F93\u5165\u4EE5\u4E0B\u547D\u4EE4\uFF0C\u65E0\u9700\u8C03\u7528\u88C1\u51B3\uFF1A","\u2022 \u5B58\u6863 / \u4FDD\u5B58 / save \u2014 \u624B\u52A8\u4FDD\u5B58\u8FDB\u5EA6","\u2022 \u8BFB\u6863 / \u8F7D\u5165 / load \u2014 \u52A0\u8F7D\u6700\u65B0\u5B58\u6863","\u2022 \u4F60\u662F\u8C01 / about \u2014 \u4E86\u89E3\u6E38\u620F","\u2022 \u5E7F\u544A / \u798F\u5229 \u2014 \u89C2\u770B\u6FC0\u52B1\u5E7F\u544A","\u3010\u73A9\u6CD5\u3011\u8F93\u5165\u5267\u60C5\u610F\u56FE\uFF08\u5982\u300C\u524D\u5F80\u6D1B\u9633\u300D\u300C\u6253\u542C\u6D88\u606F\u300D\u300C\u6295\u9760\u66F9\u64CD\u300D\uFF09\u53EF\u63A8\u8FDB\u6545\u4E8B\uFF0C\u6B66\u529B\u3001\u667A\u529B\u7B49\u5C5E\u6027\u4F1A\u5F71\u54CD\u5267\u60C5\u8D70\u5411\u3002"]),h(),!0;if(e==="save")return Y(),!0;if(e==="load"){let n=V();return w(o.dialogueHistory,n?"\u3010\u63D0\u793A\u3011\u6700\u65B0\u5B58\u6863\u5DF2\u52A0\u8F7D\u3002":"\u3010\u63D0\u793A\u3011\u6682\u65E0\u53EF\u7528\u5B58\u6863\u3002"),h(),!0}return e==="about"?(w(o.dialogueHistory,"\u6211\u662F\u4E00\u540D\u8D1F\u8D23\u4E3B\u6301\u5192\u9669\u7684\u519B\u673A\u53C2\u8C0B\uFF0C\u968F\u65F6\u8BB0\u5F55\u4F60\u7684\u6BCF\u4E00\u6B21\u6289\u62E9\u3002"),h(),!0):e==="ad"?(oe("user-request"),w(o.dialogueHistory,"\u5E7F\u544A\u52A0\u8F7D\u4E2D\uFF0C\u5B8C\u6210\u89C2\u770B\u53EF\u83B7\u5F97\u989D\u5916\u8D44\u6E90\u5956\u52B1\u3002"),h(),!0):!1}function Et(){je||!C()||(Le(t=>ce(t)),Ee(t=>Ht(t)),Re(t=>Dt(t)),He(t=>{q(o.input,t.value),h()}),De(()=>{B().catch(t=>console.error(t))}),_e(()=>{k(o.input,!1),h()}),je=!0)}function Rt(t,e){if(!o.layout)return;let n=o.layout.inputArea,r=12,a=64,i={x:n.x+n.width-r-a,y:n.y+r,width:a,height:n.height-r*2};K(i,t,e)?B().catch(s=>console.error(s)):de()}function $e(){var s;if(le)return{ready:!0};let t=Pe();if(!t)return{ready:!1,message:"\u65E0\u6CD5\u521B\u5EFA Canvas\uFF0C\u4E0A\u4E0B\u6587\u4E0D\u53EF\u7528"};let e=te(),n=e.pixelRatio||1,r=e.windowWidth,a=e.windowHeight,i=t.getContext("2d");return i?(n!==1&&typeof i.scale=="function"&&i.scale(n,n),o.canvas=t,o.ctx=i,o.screenWidth=r,o.screenHeight=a,o.pixelRatio=n,o.layout=we(o.screenWidth,o.screenHeight,(s=e.safeAreaTop)!=null?s:0),v.init(),V(),Et(),h(),le=!0,{ready:!0}):{ready:!1,message:"\u65E0\u6CD5\u83B7\u53D6 CanvasRenderingContext2D"}}function Be(){if(o.loopActive)return;o.loopActive=!0;let t=()=>{h(),re(t)};re(t)}function Ye(t){var s,u,c,l,d;let e=(c=(s=t.touches)==null?void 0:s[0])!=null?c:(u=t.changedTouches)==null?void 0:u[0];if(!e)return null;let n=(l=e.clientX)!=null?l:e.x,r=(d=e.clientY)!=null?d:e.y;if(n==null||r==null)return null;let a=o.pixelRatio>0?o.pixelRatio:1,i=typeof e.clientX=="number";return{x:i?n:n/a,y:i?r:r/a}}function Ht(t){if(!o.isDialogueScrollActive||!o.layout)return;let e=Ye(t);if(!e)return;let n=o.touchStartY-e.y,r=Math.max(0,o.dialogueHistory.length*50-o.layout.dialogueArea.height);o.dialogueScrollOffset=Math.max(0,Math.min(r,o.touchStartScroll+n)),o.touchStartY=e.y,o.touchStartScroll=o.dialogueScrollOffset}function Dt(t){o.isDialogueScrollActive=!1}function ce(t){var l,d;if(!o.layout)return;let e=Ye(t);if(!e)return;let{x:n,y:r}=e;L.DEBUG_TOUCH&&typeof wx!="undefined"&&wx.showToast&&wx.showToast({title:`x:${Math.round(n)} y:${Math.round(r)}`,icon:"none",duration:500});let{inputArea:a,saveLoadPanel:i,attributePanel:s,dialogueArea:u}=o.layout;if(K(a,n,r)){Rt(n,r);return}if(K(u,n,r)){o.isDialogueScrollActive=!0,o.touchStartY=r,o.touchStartScroll=o.dialogueScrollOffset;return}if(o.isSaveLoadPanelVisible&&K(i,n,r)){let f=((l=i.x)!=null?l:0)+i.width/2;n<f?Y():$();return}let c=((d=s.x)!=null?d:0)+s.width-60;K(s,n,r)&&n>=c&&$()}function de(){k(o.input,!0),Me(o.input.value),h()}async function B(){var l,d,f,p,A;if(o.isAdjudicating){typeof wx!="undefined"&&wx.showToast&&wx.showToast({title:"\u6B63\u5728\u5904\u7406\uFF0C\u8BF7\u7A0D\u5019",icon:"none",duration:1500});return}let t=o.input.value.trim();if(!t)return;if(await Lt(t)){J(o.input),ne(),k(o.input,!1),h();return}let n=await Ke(t);if(!n.allowed){w(o.dialogueHistory,(l=n.reason)!=null?l:"\u8F93\u5165\u672A\u901A\u8FC7\u5B89\u5168\u5BA1\u6838"),h();return}let r="\uFF08\u6B63\u5728\u751F\u6210\u5267\u60C5\uFF0C\u8BF7\u7A0D\u5019\u2026\u9996\u6B21\u54CD\u5E94\u53EF\u80FD\u9700 5\uFF5E15 \u79D2\uFF09";w(o.dialogueHistory,[`\u4F60\u8BF4\uFF1A"${t}"`,r]),o.currentSaveData&&v.addDialogueHistory(o.currentSaveData,[`\u4F60\u8BF4\uFF1A"${t}"`,r]),J(o.input),ne(),k(o.input,!1),ue(),h(),o.isAdjudicating=!0;let a=At(t),i=L.ADJUDICATION_API,s=/localhost|127\.0\.0\.1/.test(i),u=typeof wx!="undefined"&&["android","ios"].includes(String((p=(f=(d=wx.getSystemInfoSync)==null?void 0:d.call(wx))==null?void 0:f.platform)!=null?p:"").toLowerCase()),c=!!(typeof wx!="undefined"&&((A=wx.cloud)!=null&&A.callFunction)&&L.CLOUD_ENV);if(s&&u&&!c){se(),It(t),o.isAdjudicating=!1;return}try{let y=await Ue(a);se(),Ct(y)}catch(y){se(),o.dialogueScrollOffset=0;let P=y instanceof Error?y.message:"\u88C1\u51B3\u8BF7\u6C42\u5931\u8D25";w(o.dialogueHistory,`\u88C1\u51B3\u5931\u8D25\uFF1A${P}\uFF08\u8BF7\u68C0\u67E5\u4E91\u51FD\u6570\u914D\u7F6E\u4E0E\u7F51\u7EDC\uFF0C\u6216\u7A0D\u540E\u91CD\u8BD5\uFF09`),h(),console.warn("\u88C1\u51B3 API \u8C03\u7528\u5931\u8D25:",y)}finally{o.isAdjudicating=!1}}function $(){o.isSaveLoadPanelVisible=!o.isSaveLoadPanelVisible,h()}function Y(){o.currentSaveData||(o.currentSaveData=v.createNewSave(0,"\u624B\u52A8\u5B58\u6863")),v.save(o.currentSaveData,!1)&&(w(o.dialogueHistory,"\u3010\u6E38\u620F\u5DF2\u4FDD\u5B58\u3011"),h(),setTimeout(()=>{o.dialogueHistory.at(-1)==="\u3010\u6E38\u620F\u5DF2\u4FDD\u5B58\u3011"&&(ee(o.dialogueHistory),h())},5e3))}function V(){let t=v.load(0);if(t)return o.currentSaveData=t,F(),!0;let e=v.createNewSave(0,"\u521D\u59CB\u5B58\u6863");return v.save(e,!1)?(o.currentSaveData=e,F(),!0):(o.currentSaveData=null,o.dialogueHistory=[...M],!1)}function Ve(t){q(o.input,t),h()}function qe(){return{initialized:le,input:o.input,currentSaveData:o.currentSaveData,dialogueHistory:o.dialogueHistory,playerAttributes:o.playerAttributes}}
