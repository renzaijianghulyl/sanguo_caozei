# 三国文字冒险 · 产品体验测试与优化建议

> 以**游戏制作人/产品经理**视角对项目进行体验测试，整理优化点清单。  
> 文档版本：1.0 | 生成日期：2026-02

---

## 一、产品定位与核心体验

### 1.1 当前优点

- 核心流程（输入意图 → LLM 裁决 → 剧情反馈）已贯通，DeepSeek 可正常调用
- 存档系统完善：手动/自动存档、读档、多槽位
- 本地指令（存档、读档、帮助、广告）拦截合理，不浪费 API 调用
- 顶部安全区域、对话区滚动已适配，基础体验可用

### 1.2 待优化方向概览

| 类别 | 优先级 | 数量 |
|------|--------|------|
| 新手引导与首次体验 | 高 | 4 |
| 交互与反馈 | 高 | 5 |
| 内容与剧情 | 中 | 4 |
| 变现与运营 | 中 | 3 |
| 技术/性能 | 中 | 3 |
| 合规与安全 | 中 | 2 |
| 长期规划 | 低 | 2 |

---

## 二、新手引导与首次体验

### 2.1 缺乏明确的新手引导

**现象**：新玩家进入后只有三段旁白，不知道可以输入什么、如何操作。

**建议**：
- 在开局旁白后追加一条**操作提示**，如：「在下方输入框输入你的意图，例如「前往洛阳」「结识豪杰」，然后点击发送。」
- 或在输入框占位文案中强化示例：「输入意图，如：前往洛阳、结识豪杰、打听消息」

**优先级**：高

---

### 2.2 输入框占位文案不够直观

**现状**：`输入意图，如：寻找盟友` 仅一个示例。

**建议**：
- 轮播或随机展示 2～3 个示例，如：「前往洛阳」「打听消息」「结识豪杰」
- 或使用更具体的引导：「你想做什么？如：前往洛阳、投靠曹操」

**优先级**：中

---

### 2.3 帮助指令内容可更丰富

**现状**：输入「帮助」仅返回一句简要说明。

**建议**：
- 增加示例意图、属性说明（武力/智力等影响什么）、常用指令一览
- 可拆成 2～3 条对话气泡，避免单条过长

**优先级**：中

---

### 2.4 首次裁决等待无预期

**现象**：首次调用大模型可能需 5～15 秒，仅显示「（等待裁决结果...）」容易让用户以为卡死。

**建议**：
- 增加简单加载动画或「正在生成剧情，请稍候…」的提示
- 超过 5 秒时可追加「首次响应较慢，请耐心等待」等说明

**优先级**：高

---

## 三、交互与反馈

### 3.1 发送中状态缺乏防重复与反馈

**现象**：`isAdjudicating` 时 `submitInput` 直接 return，但用户可能不清楚「已发送、请等待」。

**建议**：
- 发送后立即在输入框区域显示「发送中，请稍候」或禁用发送按钮
- 确保 `isAdjudicating` 期间再次点击发送有 Toast 提示：「正在处理上一条，请稍候」

**优先级**：高

---

### 3.2 对话区滚动无视觉反馈

**现象**：支持上滑查看更多，但用户可能不知道可滚动。

**建议**：
- 当有更多内容时，底部「↑ 上滑查看更多」可更明显（如加图标或闪烁提示）
- 首次出现可滚动内容时，可做一次简短引导

**优先级**：低

---

### 3.3 存档/读档面板入口不够显眼

**现状**：需点击属性面板右侧区域才能打开存档面板，新用户不易发现。

**建议**：
- 在属性面板增加「存档」文字按钮，或在布局上明确标注
- 首次进入游戏可做一次「点击这里可保存进度」的提示

**优先级**：中

---

### 3.4 保存成功提示会自动消失

**现状**：「【游戏已保存】」3 秒后自动移除，用户可能没看清。

**建议**：
- 改为 5 秒，或改为在属性区「已存档」旁做短时高亮
- 可增加轻微动画（如淡入淡出）提升感知

**优先级**：低

---

### 3.5 键盘收起后的交互

**现象**：部分机型键盘收起后，输入框可能仍显示「输入中...」状态。

**建议**：
- 确认 `onKeyboardComplete` 与 `hideKeyboard` 的调用时机
- 增加 `wx.onHide` 时重置键盘状态的兜底逻辑

**优先级**：中（若复现率高则提升）

---

## 四、内容与剧情

### 4.1 System Prompt 仍为占位

**现状**：`src/agents/prompts.ts` 中的 `bootstrapDefaultPrompts` 为占位文案；云函数内使用独立 `SYSTEM_PROMPT`，与 contentRegistry 未打通。

**建议**：
- 统一 Prompt 来源：云函数从配置或 contentRegistry 同步获取，或至少与 `docs/内容文案规范_供内容AI使用.md` 一致
- 补充正式的三国世界观、叙事风格、输出格式等 System Prompt

**优先级**：高

---

### 4.2 剧情连贯性依赖 LLM

**现象**：仅传最近 3 条对话给 LLM，长线剧情可能割裂。

**建议**：
- 可考虑将 `recentDialogue` 增至 5～7 条，或按 token 限制动态裁剪
- 在 Prompt 中强调「承接上文语境，保持剧情连贯」

**优先级**：中

---

### 4.3 属性与资源对剧情的影响不透明

**现象**：武力、智力等会影响剧情，但玩家不清楚具体规则。

**建议**：
- 在帮助或「关于」中简要说明各属性的作用
- 或在世界观介绍中提及「你的能力将影响诸侯态度与事件结果」

**优先级**：低

---

### 4.4 地理位置与场景展示不足

**现状**：`player.location.region`、`scene` 有数据，但主界面未展示当前位置。

**建议**：
- 在属性面板或对话区顶部显示「当前位置：颍川 · 村庄」等
- 增强空间感，方便玩家理解剧情发生的场所

**优先级**：中

---

## 五、变现与运营

### 5.1 激励广告未配置真实广告位

**现状**：`rewardedAd.ts` 使用 `adunit-1234567890abcdef` 占位，真机无法加载。

**建议**：
- 在微信公众平台申请激励视频广告位，替换真实 `adUnitId`
- 在文档中注明「上线前需配置广告位 ID」

**优先级**：高（若计划上线变现）

---

### 5.2 广告触发时机可优化

**现状**：在 `legend+` 或 `gold+` 时触发，以及用户输入「广告」时触发。

**建议**：
- 增加「体力耗尽」「剧情高潮节点」等触发场景（需与剧情设计配合）
- 避免同一会话内频繁弹出，可加冷却时间

**优先级**：中

---

### 5.3 运营位未实现

**现状**：产品框架中规划了「公告/福利/活动」占位，当前未落地。

**建议**：
- 预留 UI 区域（如顶部 banner 或设置入口）
- 通过远程配置或 CMS 注入公告内容，便于运营活动

**优先级**：低（可作后续迭代）

---

## 六、技术 / 性能

### 6.1 对话区离屏缓存在微信环境可能不可用

**现状**：`renderer.ts` 使用 `OffscreenCanvas` 或 `document.createElement('canvas')`，微信小游戏环境可能不支持。

**建议**：
- 在微信环境下检测 `OffscreenCanvas` 与 `document`，不可用时回退到直接绘制（已有 fallback，需确认无报错）
- 若离屏缓存不可用，长对话滚动时的性能需关注

**优先级**：中

---

### 6.2 自动保存间隔偏长

**现状**：30 秒自动保存，若用户在 25 秒时切出，可能丢失进度。

**建议**：
- 改为 15～20 秒，或在每次裁决完成后立即自动保存（当前已有，可确认是否覆盖所有路径）
- 在 `wx.onHide` 时触发一次即时保存

**优先级**：中

---

### 6.3 云函数成本与缓存

**现状**：每次裁决均完整调用 DeepSeek，无缓存。

**建议**：
- 对相同意图+状态的请求可做短期缓存（如 5 分钟），减少重复调用
- 监控云函数调用量与成本，设置告警

**优先级**：低（量上来后再优化）

---

## 七、合规与安全

### 7.1 敏感词库可扩充

**现状**：`contentGuard.ts` 中 `LOCAL_BLOCKLIST` 词条较少。

**建议**：
- 根据实际审核反馈补充常见违规词
- 定期与 `wx.msgSecCheck` 的拦截结果对照，迭代本地词库

**优先级**：中

---

### 7.2 生成内容审核失败时的体验

**现状**：`sanitizeNarrative` 失败时展示「内容暂时不可用」或 `reason`。

**建议**：
- 可考虑使用更温和的 fallback 叙事，如「此事暂且按下不表，容后再议。」减少「被拦截」的负面感知
- 在日志中记录审核失败次数，用于内容与 Prompt 优化

**优先级**：低

---

## 八、文档与可维护性

### 8.1 文案规范与实现不一致

**现状**：`docs/内容文案规范_供内容AI使用.md` 中部分条目（如 R6～R20、A13 等）在 `renderer.ts`、`gameApp.ts` 中未完全对应。

**建议**：
- 以规范文档为基准，逐项核对并统一
- 或更新规范文档，标明「已废弃/未实现」的条目

**优先级**：低

---

### 8.2 README 与部署文档可补充

**现状**：README 较简略，云开发部署有单独文档。

**建议**：
- 在 README 中增加「快速体验」「云函数配置」「常见问题」的链接与摘要
- 将 `docs/云开发_裁决API部署指南.md` 的要点提炼到 README

**优先级**：低

---

## 九、优化项汇总（按优先级排序）

### 高优先级（建议尽快处理）

| 序号 | 优化项 | 涉及模块 |
|------|--------|----------|
| 1 | 新增新手引导：开局后提示「如何输入意图」 | gameApp、文案 |
| 2 | 裁决等待时增加加载提示/防重复点击 | gameApp、renderer |
| 3 | 统一并完善 System Prompt（云函数与 contentRegistry） | prompts、云函数 |
| 4 | 配置真实激励视频广告位 ID | rewardedAd、config |

### 中优先级（1～2 个迭代内完成）

| 序号 | 优化项 | 涉及模块 |
|------|--------|----------|
| 5 | 丰富帮助指令内容 | gameApp |
| 6 | 输入框占位示例轮播/多样化 | renderer |
| 7 | 存档面板入口更显眼 | layout、renderer |
| 8 | 主界面展示当前位置（如颍川·村庄） | renderer、layout |
| 9 | `recentDialogue` 条数或 token 优化 | snapshot、云函数 |
| 10 | 自动保存间隔与 onHide 即时保存 | saveManager、gameApp |
| 11 | 离屏缓存在微信环境的兼容性确认 | renderer |
| 12 | 扩充本地敏感词库 | contentGuard |

### 低优先级（后续迭代）

| 序号 | 优化项 | 涉及模块 |
|------|--------|----------|
| 13 | 对话区滚动引导优化 | renderer |
| 14 | 保存成功提示时长/动画 | gameApp |
| 15 | 广告触发节奏与冷却 | rewardedAd、gameApp |
| 16 | 云函数缓存策略 | 云函数 |
| 17 | 文案规范与实现对齐 | docs、多处 |
| 18 | README 与文档完善 | README、docs |

---

## 十、测试用例建议（供回归验证）

1. **新用户流程**：首次进入 → 阅读旁白 → 输入第一条意图 → 等待裁决 → 收到剧情
2. **本地指令**：依次输入「帮助」「存档」「读档」「你是谁」「广告」，确认均不调用 LLM
3. **存档流程**：手动存档 → 继续游戏 → 读档 → 确认状态恢复
4. **异常流程**：断网下发意图 → 确认错误提示；敏感词输入 → 确认拦截提示
5. **长对话**：连续 10+ 轮对话 → 确认可滚动查看历史，自动保存正常
6. **多机型**：刘海屏、小屏机、横竖屏切换（若支持）下的布局与安全区域

---

## 附录：游戏制作人（Producer）角色说明

在游戏研发中，负责整体体验、排期与资源配置的角色通常称为 **游戏制作人（Game Producer）** 或 **产品经理（Product Manager）**。本清单的视角结合了两者：既关注功能完整性，也关注玩法体验与商业化落地。
