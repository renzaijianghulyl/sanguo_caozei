# 项目文件夹说明

本文档说明工程根目录下各文件夹的用途，便于快速定位代码与资源。

---

## 根目录下的一级文件夹

| 文件夹 | 用途 |
|--------|------|
| **src** | 源码主目录，小游戏与裁决流程的 TypeScript 代码都在这里（见下方 src 子目录说明）。 |
| **cloudfunctions** | 微信云开发云函数。当前仅有 **adjudication**：裁决 API，接收玩家意图与状态、调用 LLM 生成剧情并返回 narrative + effects + suggested_actions。 |
| **scripts** | 构建与本地开发脚本。如 `build.js`（打包生成 dist / min.js）、`localAdjudicationServer.js`（本地模拟裁决服务）等。 |
| **assets** | 静态资源。如 **audio**：音效、环境音等；立绘、图片路径也由此管理。 |
| **docs** | 项目文档。设计说明、API 说明、测试报告、数据库说明、重构与优化方案等；**playtest-reports** 下为各轮试玩报告。 |
| **tests** | 自动化测试。**functional**：功能/业务单测；**integration**：集成测试（快照、裁决流程、叙事等）；**playtest**：试玩/内测 AI 相关脚本与配置。 |
| **dist** | 构建产物目录，供微信开发者工具导入使用（game.json、*.min.js 等）。 |
| **ui-preview** | 若存在，一般为 UI 或布局的预览/调试用页面或脚本。 |

---

## src 下的子文件夹

| 文件夹 | 用途 |
|--------|------|
| **src/agents** | LLM 相关：提示词 key 定义、默认 prompt 注册（`prompts.ts`），与「系统提示 / 叙事约束」文案集中管理。 |
| **src/app** | 应用层：游戏主流程（`gameApp.ts`）、裁决请求/结果处理（`adjudicationFlow.ts`）、打字机（`typewriter.ts`）、本地意图拦截（`localIntents.ts`）、生命周期（`lifecycle.ts`）、立志解析（`aspirationParser.ts`）等。 |
| **src/config** | 配置与常量：客户端配置（`index.ts`）、指令阈值（`instructionThresholds.ts`）、世界时间线配置（`worldTimeline.ts`）等。 |
| **src/core** | 游戏引擎核心：状态与类型（`state.ts`）、快照与 event_context 构建（`snapshot.ts`、`eventContextPipeline.ts`）、预裁决与逻辑预处理（`preAdjudicator.ts`）、效果应用（`effectsApplier.ts`）、羁绊与关系（`BondSystem.ts`、`RelationManager.ts`）、叙事去重（`narrativeDiversity.ts`）、内容注册表（`contentRegistry.ts`）、历史日志（`historyLog.ts`）等。 |
| **src/data** | 静态/配置数据与数据访问：**sanguoDb**（三国数据库：武将、城池、时间线 JSON 与封装）、**bond**（羁绊模板、初始羁绊等）、**actionSuggestions**（行动建议数据）等。 |
| **src/services** | 各类服务封装：**network**（裁决 API 调用）、**storage**（存档、隐私同意）、**security**（内容安全、反馈日志）、**analytics**（微信事件上报）、**ads**（激励视频）、**audio**（环境音）等。 |
| **src/ui** | 渲染与交互：布局计算（`layout.ts`）、主题与基础图形（`theme.ts`、`primitives.ts`）、主渲染器（`renderer.ts`）、启动页（`splash.ts`）、角色创建（`characterCreation.ts`）、隐私弹窗（`privacyModal.ts`）、输入框与菜单（`input.ts`、`menu.ts`）等。 |
| **src/utils** | 工具函数：微信 API 封装（`wxHelpers.ts`）、对话缓冲（`dialogueBuffer.ts`）、网络请求（`network/request.ts`）等。 |
| **src/types** | 全局类型声明（如 `global.d.ts`），供 TS 与 IDE 使用。 |

---

## 其他常见路径速查

- **入口**：`src/game.ts`（小游戏入口）、`src/app.ts`（应用入口）。
- **裁决请求构建**：`src/core/snapshot.ts` + `src/core/eventContextPipeline.ts`。
- **裁决调用**：`src/services/network/adjudication.ts`；云函数实现：`cloudfunctions/adjudication/index.js`。
- **提示词**：`src/agents/prompts.ts`；汇总说明见 `docs/提示词相关文件汇总.md`。

如需扩展功能，一般可先根据上表确定模块（agents / app / core / data / services / ui），再在对应目录下查找或新增文件。
